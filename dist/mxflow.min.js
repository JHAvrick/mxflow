/*! For license information please see mxflow.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mxflow=t():e.mxflow=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var o=n.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();var t,n,o,r,s={};e.r(s),e.d(s,{MXFlow:()=>Q}),function(e){e.TOP="top",e.RIGHT="right",e.LEFT="left",e.BOTTOM="bottom",e.CENTER="center"}(t||(t={})),function(e){e.None="none",e.Graph="graph",e.Link="link",e.Node="node",e.Edge="edge"}(n||(n={})),function(e){e.Type="data-mxflow-type",e.Key="data-mxflow-key",e.NodeTemplate="data-mxflow-node-template",e.NodeContent="data-mxflow-node-content",e.EdgeGroup="data-mxflow-edge-group",e.EdgeLatch="data-mxflow-edge-latch"}(o||(o={})),function(e){e.Container="mxflow-container",e.Root="mxflow-root",e.RootPanning="mxflow-root--panning",e.Background="mxflow-background",e.Dots="mxflow-dots",e.Grid="mxflow-grid",e.GridInner="mxflow-grid-inner",e.GridOuter="mxflow-grid-outer",e.Context="mxflow-context",e.ItemSelected="mxflow-item--selected",e.ItemPreselected="mxflow-item--preselected",e.Nodes="mxflow-nodes",e.Node="mxflow-node",e.NodeContent="mxflow-node-content",e.EdgeGroup="mxflow-edge-group",e.Edge="mxflow-edge",e.EdgeValid="mxflow-edge--valid",e.EdgeInvalid="mxflow-edge--invalid",e.Lasso="mxflow-lasso",e.Links="mxlflow-links",e.Link="mxflow-link",e.LinkBand1="mxflow-link-band1",e.LinkBand2="mxflow-link-band2",e.LinkBand3="mxflow-link-band3",e.LinkValid="mxflow-link--valid",e.LinkInvalid="mxflow-link--invalid",e.GhostLinks="mxflow-ghost-links",e.GhostLink="mxflow-ghost-link"}(r||(r={}));const l=(e,t,n,o,r)=>{let s=Math.abs(n-e)*r;return`M${e} ${t} C ${Math.max(e,n)-s} ${t} ${Math.min(e,n)+s} ${o} ${n} ${o}`},i=(e,t)=>{let n=e;return[e=t,t=n]},a=e=>JSON.parse(JSON.stringify(e)),d=(e,t,n)=>Math.min(Math.max(e,t),n),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return Object.keys(e).reduce(((o,r)=>Object.assign({},o,"[object Object]"===Object.prototype.toString.call(e[r])?c(e[r],t.concat([r]),n):{[t.concat([r]).join(n)]:e[r]})),{})},p=(e,t)=>e.split(".").reduce(((e,t)=>e?e[t]:null),t||self),u=(e,t,n)=>{let o=e.split(".");for(let e=0;e<o.length-1;e++)null!=t[o[e]]&&null!=t[o[e]]||(t[o[e]]={}),t=t[o[e]];t[o[o.length-1]]=n},g=`\n    <div ${o.NodeTemplate}>\n        <ul ${o.EdgeGroup}="inputs" ${o.EdgeLatch}="center">\n            \x3c!-- Input Edges Dynamically Populated --\x3e\n        </ul>\n        <div ${o.NodeContent}>\n            \x3c!-- Node Content as Provided by User --\x3e\n        </div>\n        <ul ${o.EdgeGroup}="outputs" ${o.EdgeLatch}="center">\n            \x3c!-- Output Edges Dynamically Populated --\x3e\n        </ul>\n    </div>\n`,h=e=>{let n=new Map;return e.querySelectorAll(`ul[${o.EdgeGroup}]`).forEach((e=>{var s;let l=e.getAttribute(o.EdgeGroup),i=(a=t,d=null!==(s=e.getAttribute(o.EdgeLatch))&&void 0!==s?s:"center",Object.values(a).includes(d)?d:void 0);var a,d;e.classList.add(r.EdgeGroup),n.set(l,{groupKey:l,groupEl:e,latchPos:null!=i?i:t.CENTER})})),n},m=e=>{var t,s,l,i;let a,d,c,p=null!==(t=e.template)&&void 0!==t?t:g;if([a,d,c]=(e=>{let t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelector(`*[${o.NodeTemplate}]`),r=t.querySelector(`*[${o.NodeContent}]`);if(!n||!r)throw new Error("Node template is missing required element.");if(!(n instanceof HTMLElement&&r instanceof HTMLElement))throw new Error("One more more template elements is of the incorrect element type.");return[t,n,r]})(p),!d||!c)throw new Error("Node template is missing required element.");if(!(d instanceof HTMLElement&&c instanceof HTMLElement))throw new Error("One more more template element is of the incorrect element type.");if(!(d instanceof HTMLElement))throw new Error('No parent HTMLElement found in Node template (w/ class "mx-flow-node").');return((e,t,r)=>{e.setAttribute(o.Type,n.Node),e.setAttribute(o.Key,t),e.setAttribute("draggable","false"),e.ondragstart=e=>e.preventDefault(),e.style.display="inline-flex",e.style.justifyContent="space-between",e.style.touchAction="none",e.style.userSelect="none",e.style.pointerEvents="all",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.zIndex=r.toString()})(d,e.key,e.z),d.classList.add(r.Node),c.classList.add(r.NodeContent),e.nodeClass&&e.nodeClass.length>0&&d.classList.add(e.nodeClass),e.width&&(d.style.width="number"==typeof e.width?`${e.width}px`:e.width),e.height&&(d.style.height="number"==typeof e.height?`${e.height}px`:e.height),{type:n.Node,template:p,key:e.key,el:d,contentEl:c,edgeGroups:h(a),x:e.x,y:e.y,z:e.z,deltaX:0,deltaY:0,width:null!==(s=e.width)&&void 0!==s?s:"auto",height:null!==(l=e.height)&&void 0!==l?l:"auto",data:null!==(i=e.data)&&void 0!==i?i:{}}},f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e.el.getBoundingClientRect();switch(e.group.latchPos.toString()){case"top":return{x:o.left-t+o.width/2,y:o.top-n};case"right":return{x:o.left-t+o.width,y:o.top-n+o.height/2};case"bottom":return{x:o.left-t+o.width/2,y:o.top-n+o.height};case"left":return{x:o.left-t,y:o.top-n+o.height/2};default:return{x:o.left-t+o.width/2,y:o.top-n+o.height/2}}},v=e=>`${e.fromNode}:${e.fromEdge}:${e.toNode}:${e.toEdge}`,y=(e,t)=>{switch(!0){case Array.isArray(e):case e instanceof Map:e.forEach((e=>e.el.classList.add(t)));break;default:e.el.classList.add(t)}},w=(e,t)=>{switch(!0){case Array.isArray(e):case e instanceof Map:e.forEach((e=>e.el.classList.remove(t)));break;default:e.el.classList.remove(t)}},E=e=>(e.el.style.transform=`translate(${e.x+e.deltaX}px, ${e.y+e.deltaY}px)`,e),k=(e,t)=>{var n;let o=e.state.transform,r=e.state.edges.get(`${t.fromNode}:${t.fromEdge}`),s=e.state.edges.get(`${t.toNode}:${t.toEdge}`);if(!r||!s)throw new Error("MXFlow.applyLinkPosition(): Cannot apply link position for undefined edge");let a=e.dom.containerEl.getBoundingClientRect(),d=a.top,c=a.left,p=f(r,c,d),u=f(s,c,d),g=p.x,h=p.y,m=u.x,v=u.y;g>m&&([g,m]=i(g,m),[h,v]=i(h,v));let y=l((g-o.x)/o.scale,(h-o.y)/o.scale,(m-o.x)/o.scale,(v-o.y)/o.scale,null!==(n=e.opts.bezierWeight)&&void 0!==n?n:.675);t.band1.setAttribute("d",y),t.band2.setAttribute("d",y),t.band3.setAttribute("d",y)},x=e=>{e.state.links.forEach((t=>k(e,t)))};class b{constructor(){this.events={}}on(e,t){return"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){if("object"!=typeof this.events[e])return;const n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}removeAllListeners(){Object.keys(this.events).forEach((e=>this.events[e].splice(0,this.events[e].length)))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];"object"==typeof this.events[e]&&[...this.events[e]].forEach((e=>e.apply(this,n)))}once(e,t){var n=this;const o=this.on(e,(function(){o();for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];t.apply(n,r)}));return o}}Object.create,Object.create;const L={x:0,y:0,suppressEvent:!1,ignoreAction:!1,edges:[]},M=e=>{const t=e.dom,s=e.state,l=e.state.transform,i=e.emit,d=t=>{var n,o,r;console.log(t),(null===(n=e.opts.undo)||void 0===n?void 0:n.enabled)&&(null===(r=null===(o=e.opts.undo)||void 0===o?void 0:o.actions)||void 0===r?void 0:r.includes(t))&&(s.undo.unshift({type:t,model:N()}),s.undo.length>50&&s.undo.pop(),s.redo=[])},c=(e,t)=>{e.forEach((e=>{s.selected.set(e.key,e),y(e,r.ItemSelected)})),u(Array.from(e.values()).filter((e=>"node"===e.type))),(null==t?void 0:t.suppressEvent)||i("selected",new Map(s.selected)),(null==t?void 0:t.ignoreAction)||d("select")},p=(e,t)=>{e.forEach((e=>{let t=s.selected.get(e);t&&(w(t,r.ItemSelected),s.selected.delete(e))})),(null==t?void 0:t.suppressEvent)||i("selected",new Map(s.selected)),(null==t?void 0:t.ignoreAction)||d("select")},u=t=>{let n=t.sort(((e,t)=>e.z>t.z?1:-1)),o=new Set(n),r=Array.from(s.nodes.values()).sort(((e,t)=>e.z>t.z?1:-1)),l=e.opts.zIndexStart;r.forEach((e=>{o.has(e)||(e.z=l,e.el.style.zIndex=e.z.toString(),l+=1)}));let i=l+n.length;n.forEach(((e,t)=>{e.z=i+t,e.el.style.zIndex=e.z.toString()}))},g=(e,t,n)=>{let o=h(e,t);if(o)switch(o.type){case"node":return void A(o.key,n);case"link":return void C(o.key,n);case"edge":return void b(o.key,n)}},h=(e,t)=>{let n;return"graph"===e?s.root:(t&&"node"===e?n=s.nodes.get(t):t&&"edge"===e?n=s.edges.get(t):t&&"link"===e&&(n=s.links.get(t)),n)},f=e=>{var n,o,s;return(null===(s=null===(o=null===(n=e.target)||void 0===n?void 0:n.closest)||void 0===o?void 0:o.call(n,`.${r.Container}`))||void 0===s?void 0:s.id)===t.instanceId},x=(e,t,l,a)=>{let c=`${t}:${l}`;if(!s.edges.has(c)){let p=s.nodes.get(t);if(p){let t=((e,t,s,l)=>{let i=e.edgeGroups.get(t);if(!i)throw new Error(`createEdge(): Unable to find group with key "${t}" in node template.`);let a=document.createElement("li");return a.classList.add(r.Edge),a.setAttribute(o.Type,n.Edge),a.setAttribute(o.Key,`${e.key}:${s}`),a.setAttribute("draggable","false"),a.ondragstart=e=>e.preventDefault(),l&&l.length>0&&a.classList.add(l),{type:n.Edge,key:`${e.key}:${s}`,group:i,nodeKey:e.key,edgeKey:s,el:a,data:{}}})(p,e,l,null==a?void 0:a.class);return t.data=(null==a?void 0:a.data)||{},s.edges.set(c,t),K(t),t.group.groupEl.appendChild(t.el),(null==a?void 0:a.suppressEvent)||i("edgeAdded",t),(null==a?void 0:a.ignoreAction)||d("addEdge"),t}throw new Error(`MXFlow: Attempted to add edge to node which doesn't exist (key="${c}")`)}throw new Error(`MXFlow: Attempted to add edge with a key that already exists (key="${c}")`)},b=(t,n)=>{let o=s.edges.get(t);if(o){if(e.opts.beforeEdgeRemoved&&!e.opts.beforeEdgeRemoved(o))return;return o.el.remove(),s.edges.delete(t),(null==n?void 0:n.suppressEvent)||i("edgeRemoved",o),void((null==n?void 0:n.ignoreAction)||d("removeEdge"))}throw new Error(`MXFlow: No edge exists with key="${t}"`)},M=function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,l,a;let c=Object.assign(Object.assign({},L),o);if(!s.nodes.has(n)){let p=m({template:e.opts.nodeHTMLTemplate,key:n,x:null!==(r=c.x)&&void 0!==r?r:0,y:null!==(l=c.y)&&void 0!==l?l:0,z:s.nodes.size+1,width:c.width,height:c.height,nodeClass:c.class,data:c.data});return s.nodes.set(n,p),null===(a=o.edges)||void 0===a||a.forEach((e=>{x(e.group,n,e.key,{data:e.data,class:e.class,suppressEvent:!0,ignoreAction:!0})})),K(p),t.nodeContainerEl.appendChild(p.el),E(p),(null==c?void 0:c.suppressEvent)||i("nodeAdded",p),void((null==c?void 0:c.ignoreAction)||d("addNode"))}throw new Error(`MXFlow: Attempted to add a node with a key that already exists (key="${n}")`)},A=(t,n)=>{let o=s.nodes.get(t);if(o){if(e.opts.beforeNodeRemoved&&!e.opts.beforeNodeRemoved(o))return;return s.selected.has(t)&&p([t],{suppressEvent:!0,ignoreAction:!0}),s.links.forEach((e=>{e.fromNode!==(null==o?void 0:o.key)&&e.toNode!==(null==o?void 0:o.key)||(e.el.remove(),s.links.delete(e.key))})),s.edges.forEach((e=>{e.nodeKey===(null==o?void 0:o.key)&&(e.el.remove(),s.edges.delete(e.key))})),o.el.remove(),s.nodes.delete(t),(null==n?void 0:n.suppressEvent)||i("nodeRemoved",o),void((null==n?void 0:n.ignoreAction)||d("removeNode"))}throw new Error(`MXFlow: No node exists with key="${t}"`)},$=(l,a,c,p,u)=>{let g={fromNode:l,fromEdge:a,toNode:c,toEdge:p},h=s.edges.get(`${l}:${a}`),m=s.edges.get(`${c}:${p}`);if(!h||!m)throw new Error(`MXFlow.addLink(): One or both edges missing "${a}", "${p}"`);if(!S(h,m))throw new Error("MXFlow.addLink(): Invalid link.");let f=v(g);if(!s.links.has(f)){let l=((e,t)=>{let s=v(e),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.classList.add(r.LinkBand1),l.style.pointerEvents="auto";let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.classList.add(r.LinkBand2),i.style.pointerEvents="none";let a=document.createElementNS("http://www.w3.org/2000/svg","path");a.classList.add(r.LinkBand3),a.style.pointerEvents="none";let d=document.createElementNS("http://www.w3.org/2000/svg","text");d.textContent="Label",d.style.color="white",d.setAttribute("width","300px"),d.setAttribute("height","300px"),d.setAttribute("textAnchor","middle");let c=document.createElementNS("http://www.w3.org/2000/svg","textPath");c.style.pointerEvents="none",d.appendChild(c);let p=document.createElementNS("http://www.w3.org/2000/svg","g");return p.setAttribute(o.Type,n.Link),p.setAttribute(o.Key,s),p.classList.add(r.Link),p.style.pointerEvents="none",p.setAttribute("draggable","false"),p.ondragstart=e=>e.preventDefault(),p.appendChild(l),p.appendChild(i),p.appendChild(a),p.appendChild(d),t&&t.length>0&&p.classList.add(t),{type:n.Link,key:s,fromNode:e.fromNode,fromEdge:e.fromEdge,toNode:e.toNode,toEdge:e.toEdge,el:p,band1:l,band2:i,band3:a,labelEl:c,data:{}}})(g,null==u?void 0:u.class);return l.data=(null==u?void 0:u.data)||{},s.links.set(f,l),t.linkContainerEl.appendChild(l.el),k(e,l),(null==u?void 0:u.suppressEvent)||i("linkAdded",l),void((null==u?void 0:u.ignoreAction)||d("addLink"))}throw new Error(`MXFlow: Attempted to add link which already exists (key="${f}")`)},C=(t,n)=>{let o=s.links.get(t);if(o){if(e.opts.beforeLinkRemoved&&!e.opts.beforeLinkRemoved(o))return;return s.selected.has(t)&&p([t],{suppressEvent:!0,ignoreAction:!0}),o.el.remove(),s.links.delete(t),(null==n?void 0:n.suppressEvent)||i("linkRemoved",o),void((null==n?void 0:n.ignoreAction)||d("removeLink"))}},S=(t,n)=>!(!t||!n||t.nodeKey===n.nodeKey||t.group.groupKey===n.group.groupKey||s.links.has(`${t.nodeKey}:${t.edgeKey}:${n.nodeKey}:${n.edgeKey}`)||s.links.has(`${n.nodeKey}:${n.edgeKey}:${t.nodeKey}:${t.edgeKey}`)||e.opts.linkValidator&&!e.opts.linkValidator(t,n)),O=e=>{s.preselected.clear(),s.selected.clear(),s.nodes.clear(),s.edges.clear(),s.links.clear(),t.linkContainerEl.innerHTML="",t.nodeContainerEl.innerHTML="",(null==e?void 0:e.suppressEvent)||i("cleared"),(null==e?void 0:e.ignoreAction)||d("clear")},N=()=>{let e={transform:s.transform,nodes:{},links:{},edges:{}};return s.nodes.forEach((t=>{e.nodes[t.key]={selected:s.selected.has(t.key),x:t.x,y:t.y,width:t.width,height:t.height,data:t.data}})),s.edges.forEach((t=>{e.edges[t.key]={nodeKey:t.nodeKey,edgeKey:t.edgeKey,groupKey:t.group.groupKey,data:t.data}})),s.links.forEach((t=>{e.links[t.key]={selected:s.selected.has(t.key),fromNode:t.fromNode,fromEdge:t.fromEdge,toNode:t.toNode,toEdge:t.toEdge,data:t.data}})),e},z=e=>{return t=void 0,n=void 0,r=function*(){return O({suppressEvent:!0,ignoreAction:!0}),Object.entries(e.nodes).forEach((e=>{M(e[0],{x:e[1].x,y:e[1].y,width:e[1].width,height:e[1].height,suppressEvent:!1,ignoreAction:!0}),e[1].selected&&c([s.nodes.get(e[0])],{ignoreAction:!0})})),Object.entries(e.edges).forEach((e=>{x(e[1].groupKey,e[1].nodeKey,e[1].edgeKey,{ignoreAction:!0})})),new Promise((t=>{requestAnimationFrame((()=>{Object.entries(e.links).forEach((e=>{$(e[1].fromNode,e[1].fromEdge,e[1].toNode,e[1].toEdge,{ignoreAction:!0}),e[1].selected&&c([s.links.get(e[0])],{ignoreAction:!0})})),t(null)}))}))},new((o=void 0)||(o=Promise))((function(e,s){function l(e){try{a(r.next(e))}catch(e){s(e)}}function i(e){try{a(r.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(l,i)}a((r=r.apply(t,n||[])).next())}));var t,n,o,r},K=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.opts.render){let r=e.renderCache.get(t.key),s=null,l=e.opts.render(t,r,o);if(t.type===n.Node?s=t.contentEl:t.type===n.Edge&&(s=t.el),!s)return;l&&(s.innerHTML="","string"==typeof l?s.insertAdjacentHTML("afterbegin",l):s.appendChild(l),e.renderCache.set(t.key,s.firstElementChild))}},T=n=>{var o,r,s,a,d,c;if(e.isLocked())return;let p=t.rootEl.getBoundingClientRect(),u=l.scale,g=(null===(o=e.opts.panzoom)||void 0===o?void 0:o.minScale)||.05,h=(null===(r=e.opts.panzoom)||void 0===r?void 0:r.maxScale)||2,m=(null===(s=e.opts.panzoom)||void 0===s?void 0:s.scaleStep)||.25,f=null!==(a=n.x)&&void 0!==a?a:l.x,v=null!==(d=n.y)&&void 0!==d?d:l.y,y=l.scale;n.scale?y=n.scale:n.scaleSteps&&(y=parseFloat((u+n.scaleSteps*m).toFixed(2))),(y<g||y>h)&&(y=l.scale);let w=-f*y,E=-v*y,k=t.containerEl.getBoundingClientRect(),x=p.width-k.width,b=p.height-k.height;w>0&&(w=0),E>0&&(E=0),w<-x&&(w=-x),E<-b&&(E=-b),e.state.transform.scale=y,e.state.transform.x=w,e.state.transform.y=E,function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];"number"!=typeof e&&!0!==e||(t.rootEl.style.transition=`transform ${"number"==typeof e?e:300}ms`),t.rootEl.style.transform=`translate(${l.x}px, ${l.y}px) scale(${l.scale})`}(null===(c=n.transition)||void 0===c||c),n.suppressEvent||i("transform",Object.assign({},l))};return{recordAction:d,undo:()=>{var t;console.log("UNDO"),(null===(t=e.opts.undo)||void 0===t?void 0:t.enabled)&&s.undo.length>1&&(s.undo.length>0&&s.redo.unshift(s.undo.shift()),z(a(s.undo[0].model)))},redo:()=>{var t;(null===(t=e.opts.undo)||void 0===t?void 0:t.enabled)&&s.redo.length>0&&(s.redo.length>0&&s.undo.unshift(s.redo.shift()),z(a(s.undo[0].model)))},addEdge:x,removeEdge:b,addNode:M,removeNode:A,addLink:$,removeLink:C,isLinkValid:S,isSelected:e=>{let t="string"==typeof e?e:e.key;return s.selected.has(t)},setSelected:(e,t)=>{let n=Array.isArray(e)?new Map(e.map((e=>[e.key,e]))):e;0===s.selected.size&&0===n.size||(w(s.selected,r.ItemSelected),s.selected=n,y(s.selected,r.ItemSelected),0!==n.size&&s.selected.size<s.nodes.size&&u(Array.from(e.values()).filter((e=>"node"===e.type)))),(null==t?void 0:t.suppressEvent)||i("selected",new Map(s.preselected)),(null==t?void 0:t.ignoreAction)||d("select")},setPreselected:(e,t)=>{let n=Array.isArray(e)?new Map(e.map((e=>[e.key,e]))):e;0===s.preselected.size&&0===n.size||(w(s.preselected,r.ItemPreselected),s.preselected=n,y(s.preselected,r.ItemPreselected)),(null==t?void 0:t.suppressEvent)||i("preselected",new Map(s.preselected))},addToSelection:c,removeFromSelection:p,removeItem:g,removedSelectedItems:e=>{let t=s.selected.size>1;s.selected.forEach((n=>{g(n.type,n.key,{suppressEvent:null==e?void 0:e.suppressEvent,ignoreAction:(null==e?void 0:e.ignoreAction)||t})})),!(null==e?void 0:e.ignoreAction)&&t&&d("removeItems")},openContextMenu:(n,o,r,l)=>{(n=>{var o,r;let s=t.contextEl,l=null===(r=(o=e.opts).renderContext)||void 0===r?void 0:r.call(o,n);l&&(s.innerHTML="","string"==typeof l?s.insertAdjacentHTML("afterbegin",l):s.appendChild(l))})(r),t.contextEl.style.left=`${n}px`,t.contextEl.style.top=`${o}px`,t.contextEl.style.display="block",s.contextOpen=!0,(null==l?void 0:l.suppressEvent)||i("contextOpened",r)},closeContextMenu:e=>{t.contextEl.style.display="none",s.contextOpen=!1,(null==e?void 0:e.suppressEvent)||i("contextClosed")},getItem:h,resolveItem:e=>{if(!f(e))return;let t,n=document.elementFromPoint(e.clientX,e.clientY);if(n){let e=n.closest(`[${o.Type}]`);e&&(e.getAttribute,t=h(e.getAttribute(o.Type),e.getAttribute(o.Key)))}return t},clear:O,getModel:N,setModel:z,getDom:()=>e.dom,getState:()=>e.state,getNodes:()=>new Map(s.nodes),getEdges:()=>new Map(s.edges),getLinks:()=>new Map(s.links),eventInGraph:f,pageToContainerPos:(e,n)=>[e-t.containerEl.offsetLeft,n-t.containerEl.offsetTop],pageToGraphPos:(e,n)=>[(Math.abs(l.x)+(e-t.containerEl.offsetLeft))/l.scale,(Math.abs(l.y)+(n-t.containerEl.offsetTop))/l.scale],setView:T,focusNode:(e,n)=>{let o=t.containerEl.getBoundingClientRect(),r=e.el.getBoundingClientRect(),s=e.x,i=e.y,a=r.width/l.scale,d=r.height/l.scale,c=o.width/l.scale,p=o.height/l.scale;T({x:s+(a-c)/2,y:i+(d-p)/2,scale:null!=n?n:l.scale})},render:K,renderAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Array.from(s.nodes.values());t.concat(Array.from(s.edges.values())),t.forEach((t=>K(t,e)))},getCompositeScale:()=>e.opts.parent?e.opts.parent.getCompositeScale()+e.state.transform.scale:e.state.transform.scale}};var A="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function $(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function C(e,t){for(var n=t.slice(0,t.length-1),o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function S(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var O={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":A?173:189,"=":A?61:187,";":A?59:186,"'":222,"[":219,"]":221,"\\":220},N={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},z={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},K={16:!1,18:!1,17:!1,91:!1},T={},I=1;I<20;I++)O["f".concat(I)]=111+I;var P=[],j="all",B=[],R=function(e){return O[e.toLowerCase()]||N[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function G(e){j=e||"all"}function D(){return j||"all"}var X=function(e){var t=e.key,n=e.scope,o=e.method,r=e.splitKey,s=void 0===r?"+":r;S(t).forEach((function(e){var t=e.split(s),r=t.length,l=t[r-1],i="*"===l?"*":R(l);if(T[i]){n||(n=D());var a=r>1?C(N,t):[];T[i]=T[i].map((function(e){return o&&e.method!==o||e.scope!==n||!function(e,t){for(var n=e.length>=t.length?e:t,o=e.length>=t.length?t:e,r=!0,s=0;s<n.length;s++)-1===o.indexOf(n[s])&&(r=!1);return r}(e.mods,a)?e:{}}))}}))};function Y(e,t,n){var o;if(t.scope===n||"all"===t.scope){for(var r in o=t.mods.length>0,K)Object.prototype.hasOwnProperty.call(K,r)&&(!K[r]&&t.mods.indexOf(+r)>-1||K[r]&&-1===t.mods.indexOf(+r))&&(o=!1);(0!==t.mods.length||K[16]||K[18]||K[17]||K[91])&&!o&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function F(e){var t=T["*"],n=e.keyCode||e.which||e.charCode;if(H.filter.call(this,e)){if(93!==n&&224!==n||(n=91),-1===P.indexOf(n)&&229!==n&&P.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=z[t];e[t]&&-1===P.indexOf(n)?P.push(n):!e[t]&&P.indexOf(n)>-1?P.splice(P.indexOf(n),1):"metaKey"===t&&e[t]&&3===P.length&&(e.ctrlKey||e.shiftKey||e.altKey||(P=P.slice(P.indexOf(n))))})),n in K){for(var o in K[n]=!0,N)N[o]===n&&(H[o]=!0);if(!t)return}for(var r in K)Object.prototype.hasOwnProperty.call(K,r)&&(K[r]=e[z[r]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===P.indexOf(17)&&P.push(17),-1===P.indexOf(18)&&P.push(18),K[17]=!0,K[18]=!0);var s=D();if(t)for(var l=0;l<t.length;l++)t[l].scope===s&&("keydown"===e.type&&t[l].keydown||"keyup"===e.type&&t[l].keyup)&&Y(e,t[l],s);if(n in T)for(var i=0;i<T[n].length;i++)if(("keydown"===e.type&&T[n][i].keydown||"keyup"===e.type&&T[n][i].keyup)&&T[n][i].key){for(var a=T[n][i],d=a.splitKey,c=a.key.split(d),p=[],u=0;u<c.length;u++)p.push(R(c[u]));p.sort().join("")===P.sort().join("")&&Y(e,a,s)}}}function H(e,t,n){P=[];var o=S(e),r=[],s="all",l=document,i=0,a=!1,d=!0,c="+";for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(s=t.scope),t.element&&(l=t.element),t.keyup&&(a=t.keyup),void 0!==t.keydown&&(d=t.keydown),"string"==typeof t.splitKey&&(c=t.splitKey)),"string"==typeof t&&(s=t);i<o.length;i++)r=[],(e=o[i].split(c)).length>1&&(r=C(N,e)),(e="*"===(e=e[e.length-1])?"*":R(e))in T||(T[e]=[]),T[e].push({keyup:a,keydown:d,scope:s,mods:r,shortcut:o[i],method:n,key:o[i],splitKey:c});void 0!==l&&!function(e){return B.indexOf(e)>-1}(l)&&window&&(B.push(l),$(l,"keydown",(function(e){F(e)})),$(window,"focus",(function(){P=[]})),$(l,"keyup",(function(e){F(e),function(e){var t=e.keyCode||e.which||e.charCode,n=P.indexOf(t);if(n>=0&&P.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&P.splice(0,P.length),93!==t&&224!==t||(t=91),t in K)for(var o in K[t]=!1,N)N[o]===t&&(H[o]=!1)}(e)})))}var _={setScope:G,getScope:D,deleteScope:function(e,t){var n,o;for(var r in e||(e=D()),T)if(Object.prototype.hasOwnProperty.call(T,r))for(n=T[r],o=0;o<n.length;)n[o].scope===e?n.splice(o,1):o++;D()===e&&G(t||"all")},getPressedKeyCodes:function(){return P.slice(0)},isPressed:function(e){return"string"==typeof e&&(e=R(e)),-1!==P.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,n=t.tagName,o=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(o=!1),o},unbind:function(e){if(e){if(Array.isArray(e))e.forEach((function(e){e.key&&X(e)}));else if("object"==typeof e)e.key&&X(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var r=n[0],s=n[1];"function"==typeof r&&(s=r,r=""),X({key:e,scope:r,method:s,splitKey:"+"})}}else Object.keys(T).forEach((function(e){return delete T[e]}))}};for(var V in _)Object.prototype.hasOwnProperty.call(_,V)&&(H[V]=_[V]);if("undefined"!=typeof window){var q=window.hotkeys;H.noConflict=function(e){return e&&window.hotkeys===H&&(window.hotkeys=q),H},window.hotkeys=H}const U=H,W={width:5e3,height:5e3,zIndexStart:100,showGrid:!0,gridSize:32,bezierWeight:.675,beforeLinkStart:()=>!0,beforeLinkEnd:()=>!0,beforeNodeRemoved:()=>!0,beforeEdgeRemoved:()=>!0,beforeLinkRemoved:()=>!0,renderContext:()=>{},render:()=>{},background:{type:"dots",size:32,html:""},drag:{cancelSelector:"",handleSelector:"",gridX:0,gridY:0,latchThreshold:5},select:{multiSelectEnabled:!0},undo:{enabled:!0,max:50,actions:["drag","addEdge","removeEdge","addLink","removeLink","addNode","removeNode","removeItems","clear","select"]},lasso:{enabled:!0},panzoom:{enabled:!0,minScale:.5,maxScale:2,scaleStep:.25,scale:1,x:0,y:0},controls:{panButton:0,panModifier:!1,panOnWheel:!1,panOnArrowKeys:!0,zoomOnWheelModifier:!1,zoomOnWheel:!0,zoomOnPinch:!0,zoomOnDoubleClick:!1,selectButton:0,multiSelectModifier:"Shift",lassoModifier:"Control",lassoButton:0}},J=e=>{var t;let n={},o=c(W);for(let r in o)u(r,n,null!==(t=p(r,e))&&void 0!==t?t:p(r,W));return n};function Q(e,t){var s,a;let c=J(t);const p=((e,t)=>{let n="mxflow-instance-"+Date.now(),s=t.background.html;return"grid"!==t.background.type&&"dots"!==t.background.type||(s=((e,t)=>{let n="";if("grid"===e){let e=t||32,o=10*e;n=`\n            <defs>\n                <pattern id="smallGrid" width="${e}" height="${e}" patternUnits="userSpaceOnUse">\n                    <path class="${r.GridInner}" d="M ${e} 0 L 0 0 0 ${e}" fill="none" stroke="#273558" stroke-width="0.5"/>\n                </pattern>\n                <pattern id="grid" width="${o}" height="${o}" patternUnits="userSpaceOnUse">\n                    <rect width="${o}" height="${o}" fill="url(#smallGrid)" />\n                    <path class="${r.GridOuter}" d="M ${o} 0 L 0 0 0 ${o}" fill="none" stroke="#273558" stroke-width="1"/>\n                </pattern>\n            </defs>\n            <rect width="100%" height="100%" fill="url(#grid)" />\n        `}else{let e=t||15;n=`\n            <pattern id="mxflow-dot-pattern" x="0" y="0" width="${e}" height="${e}" patternUnits="userSpaceOnUse">\n                <circle cx="0.4" cy="0.4" r="0.4" fill="#81818a"></circle>\n            </pattern>\n            <rect x="0" y="0" width="100%" height="100%" fill="url(#mxflow-dot-pattern)"></rect>\n        `}return`\n        <svg class="${"grid"===e?r.Grid:r.Dots}" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" \n            style="position:absolute; top:0; left:0; pointer-events:none; opacity:.5; display:block;'">\n            ${n}\n        </svg>\n    `})(t.background.type,t.background.size)),e.insertAdjacentHTML("afterbegin",`\n        <div id="${n}" class="${r.Container}"\n            tabindex="1" \n            style="position:relative; display:block; width:100%; height:100%; overflow:hidden; pointer-events:auto; padding:0px; outline:none"\n            ondragstart="event.preventDefault()">\n            <svg style="position:absolute; left:0px; top:0px; width:100%; height:100%; pointer-events:none; padding: 0px; z-index:1000;">\n                <rect class="${r.Lasso}" \n                    ondragstart="event.preventDefault()"\n                    style="position:absolute; display:none; z-index: 3; pointer-events:none;">\n                </rect>\n            </svg>\n\n            \x3c!-- <div class="${r.Lasso}"\n                ondragstart="event.preventDefault()"\n                style="position:absolute; display:none; z-index: 3; pointer-events:none;">\n            </div> --\x3e\n            <div class="${r.Context}"\n                ondragstart="event.preventDefault()"\n                style="display:none; position:absolute; z-index: 10;">\n                \x3c!-- Context Menu Populated Here --\x3e\n            </div>\n            <div class="${r.Root}"\n                ${o.Type}="graph"\n                ${o.Key}="graph"\n                ondragstart="event.preventDefault()"\n                style="position:relative; height:${t.height}px; width:${t.width}px; pointer-events:auto; transform-origin: 0 0; touch-action: none;">\n\n                <div class="${r.Background}" style="width:100%;height:100%;display:${"none"===t.background.type?"none":"block"};">\n                    ${s}\n                </div>\n                <svg class="${r.Links}" \n                        ondragstart="event.preventDefault()"\n                        style="position:absolute; left:0px; top:0px; width:100%; height:100%; pointer-events:none; padding: 0px;">\n                        \x3c!-- Links Populated Here --\x3e\n                </svg>\n                <svg class="${r.GhostLinks}" \n                     ondragstart="event.preventDefault()"\n                     style="position:absolute; left:0px; top:0px; width:100%; height:100%; pointer-events:none; padding: 0px; z-index:1000;">\n                     <g style="position:absolute; pointer-events:none; overflow:visible; ">\n                        <path class="${r.GhostLink}" style="display:none;"></path>\n                     </g>\n                </svg>\n                <div class="${r.Nodes}">\n                    \x3c!-- Nodes Populated Here --\x3e\n                </div>\n            </div>\n        </div>\n    `),{instanceId:n,containerEl:e.querySelector("."+r.Container),lassoEl:e.querySelector("."+r.Lasso),contextEl:e.querySelector("."+r.Context),rootEl:e.querySelector("."+r.Root),nodeContainerEl:e.querySelector("."+r.Nodes),linkContainerEl:e.querySelector("."+r.Links),ghostLinkContainerEl:e.querySelector("."+r.GhostLinks),ghostLinkEl:e.querySelector("."+r.GhostLink)}})(e,c),u=(e=>({root:{key:"graph",type:n.Graph,el:e.rootEl},nodes:new Map,edges:new Map,links:new Map,preselected:new Map,selected:new Map,contextOpen:!1,undo:[],redo:[],transform:{x:0,y:0,scale:1}}))(p),g=new b,h=new Map,m=new Map;let v=!1;const y={tools:h,opts:c,dom:p,state:u,emit:(e,t)=>{g.emit(e,t)},lock:e=>{!v&&h.has(e)&&(v=h.get(e))},unlock:()=>v=!1,isLocked:e=>!1!==v&&v.name!==e,renderCache:m},w=M(y),k=((e,t)=>{const n=new b,o=(e,t)=>{n.emit(e,t)},r=(e=>{const t=e.opts.controls,n=new Map;return"string"==typeof t.multiSelectModifier&&n.set(t.multiSelectModifier.toLowerCase(),!1),"string"==typeof t.panModifier&&n.set(t.panModifier.toLowerCase(),!1),"string"==typeof t.zoomOnWheelModifier&&n.set(t.zoomOnWheelModifier.toLowerCase(),!1),"string"==typeof t.lassoModifier&&n.set(t.lassoModifier.toLowerCase(),!1),n})(e),s={thresholdMs:25,lastTarget:null,timeout:null},l={thresholdPx:3,startEvent:null,latched:!1},i=(t,n)=>{let o=t.clientX-l.startEvent.clientX,r=t.clientY-l.startEvent.clientY;return{start:l.startEvent,source:null!=n?n:t,deltaX:o,deltaY:r,scaledDeltaX:o/e.state.transform.scale,scaledDeltaY:r/e.state.transform.scale}},a=e=>{s.lastTarget?e.target===s.lastTarget?o("doubletap",{source:e}):window.clearTimeout(s.timeout):(s.lastTarget=e.target,s.timeout=window.setTimeout((()=>s.lastTarget=null),s.thresholdMs)),e.isPrimary&&(l.startEvent=e),o("down",{source:e})},d=e=>{e.isPrimary&&l.startEvent&&(l.latched?o("drag",i(e)):(e=>{let t=e.clientX-l.startEvent.clientX,n=e.clientY-l.startEvent.clientY;return Math.abs(t)>l.thresholdPx||Math.abs(n)>l.thresholdPx})(e)&&(o("dragstart",i(l.startEvent,l.startEvent)),l.startEvent=e,l.latched=!0)),o("move",{source:e})},c=e=>{l.startEvent&&e.isPrimary&&(l.latched&&o("dragend",i(e)),l.latched=!1,l.startEvent=null),o("up",{source:e})},p=e=>{o("doubletap",{source:e})},u=e=>{let t=e.key.toLowerCase();null!=r.get(t)&&r.set(t,"keydown"===e.type)},g=e=>{u(e),o("keydown",{source:e})},h=e=>{u(e),o("keyup",{source:e})},m=e=>{t.eventInGraph(e)&&(e.preventDefault(),o("contextmenu",{source:e,item:t.resolveItem(e)}))},f=e=>{t.eventInGraph(e)&&o("wheel",{source:e})};return document.addEventListener("pointerdown",a),document.addEventListener("pointermove",d),document.addEventListener("pointerup",c),document.addEventListener("keydown",g),document.addEventListener("keyup",h),document.addEventListener("dblclick",p),document.addEventListener("contextmenu",m),document.addEventListener("wheel",f),{on(e,t){n.on(e,t)},removeListener(e,t){n.removeListener(e,t)},dispose(){document.removeEventListener("pointerdown",a),document.removeEventListener("pointerdown",c),document.removeEventListener("pointerdown",d),document.removeEventListener("keydown",g),document.removeEventListener("keyup",h),document.removeEventListener("dblclick",p),document.removeEventListener("contextmenu",m),document.removeEventListener("wheel",f)},isModActive(t){let n=e.opts.controls[t];if("string"==typeof n)return r.get(n.toLowerCase())},isModKeyActive:e=>r.get(e.toLowerCase()),rebaseDrag(e){l.startEvent=e},dragging:()=>l.latched}})(y,w);return h.set("select",function(e,t,n){let o=e.state,r=!1;const s=()=>r=!0,l=o=>{let r=o.source,s=t.resolveItem(o.source);if(!s||!t.eventInGraph(r))return;let l=n.isModActive("multiSelectModifier");if("graph"===s.type){if(l)return;if(n.isModActive("lassoModifier")&&r.button===e.opts.controls.lassoButton)return;r.button===e.opts.controls.selectButton&&t.setSelected([])}if(("link"===s.type||"node"===s.type)&&r.button===e.opts.controls.selectButton)switch(!0){case!l&&!t.isSelected(s):t.setSelected([s]);break;case l&&!t.isSelected(s):t.addToSelection([s]);break;case l&&t.isSelected(s):t.removeFromSelection([s.key])}},i=e=>{let s=t.resolveItem(e.source);((e,s)=>!r&&!n.isModActive("multiSelectModifier")&&t.eventInGraph(e.source)&&s&&("link"===s.type||"node"===s.type)&&o.selected.size>1)(e,s)&&t.setSelected([s]),r=!1};return n.on("dragstart",s),n.on("down",l),n.on("up",i),{name:"select",dispose:()=>{n.removeListener("dragstart",s),n.removeListener("down",l),n.removeListener("up",i)},update:e=>o=e.state}}(y,w,k)),(null===(s=y.opts.lasso)||void 0===s?void 0:s.enabled)&&h.set("lasso",function(e,t,n){let o=e.state,r=e.dom;const s=o=>{let s=t.resolveItem(o.source);((t,o)=>{if(o&&"graph"===o.type)return e.opts.controls.lassoModifier?t.button===e.opts.controls.lassoButton&&n.isModActive("lassoModifier"):t.button===e.opts.controls.lassoButton})(o.source,s)&&(r.lassoEl.style.display="block",e.lock("lasso"),n.on("drag",l),n.on("dragend",i))},l=e=>{let n,s,l=new Map,i=Math.abs(e.deltaX),a=Math.abs(e.deltaY);[n,s]=t.pageToContainerPos(Math.min(e.start.pageX,e.source.pageX),Math.min(e.start.pageY,e.source.pageY)),r.lassoEl.setAttribute("x",n+"px"),r.lassoEl.setAttribute("y",s+"px"),r.lassoEl.setAttribute("width",i+"px"),r.lassoEl.setAttribute("height",a+"px");let d=r.lassoEl.getBoundingClientRect();o.nodes.forEach((e=>{var t,n;t=e.el.getBoundingClientRect(),(n=d).left>t.right||n.right<t.left||n.top>t.bottom||n.bottom<t.top||l.set(e.key,e)})),t.setPreselected(l)},i=s=>{r.lassoEl.style.display="none",r.lassoEl.setAttribute("width","0px"),r.lassoEl.setAttribute("height","0px"),t.setSelected(new Map(o.preselected)),t.setPreselected(new Map),e.unlock(),n.removeListener("drag",l),n.removeListener("dragend",i)};return n.on("dragstart",s),{name:"lasso",dispose:()=>{n.removeListener("dragstart",s),n.removeListener("drag",l),n.removeListener("dragend",i)},update:e=>{o=e.state,r=e.dom}}}(y,w,k)),(null===(a=y.opts.panzoom)||void 0===a?void 0:a.enabled)&&h.set("panzoom",function(e,t,n){let o=e.opts.controls,s=e.opts.panzoom,l=e.state,i=e.dom,a=l.transform,c=!1,p=e.opts.width,u=e.opts.height,g=0,h=0,m=0,f=0;i.rootEl.getBoundingClientRect();const v=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];i.rootEl.style.transition=e?"transform .3s":"",i.rootEl.style.transform=`translate(${a.x+g}px, ${a.y+h}px) scale(${a.scale})`},y=()=>{let t=i.containerEl.getBoundingClientRect();f=e.opts.width*a.scale-(Math.abs(a.x)+t.width),m=e.opts.height*a.scale-(Math.abs(a.y)+t.height)},w=s=>{((t,r)=>{let s=!o.panModifier||n.isModActive("panModifier");return!e.isLocked()&&t.isPrimary&&"graph"===(null==r?void 0:r.type)&&s&&("mouse"!==t.pointerType||t.button===o.panButton)})(s.source,t.resolveItem(s.source))&&(y(),c=!0,n.on("drag",E),n.on("dragend",k),e.dom.rootEl.classList.add(r.RootPanning))},E=e=>{y(),g=-d(-e.deltaX,a.x,f),h=-d(-e.deltaY,a.y,m),console.log(f,m),v(!1)},k=t=>{a.x=a.x+g,a.y=a.y+h,g=0,h=0,n.removeListener("drag",E),n.removeListener("dragend",k),c=!1,e.dom.rootEl.classList.remove(r.RootPanning),v()},x=(e,t)=>{g=0,h=0;let n=i.containerEl.getBoundingClientRect();a.x=-d(-(a.x+e),0,p*a.scale-n.width),a.y=-d(-(a.y+t),0,u*a.scale-n.height),v()},b=t=>{if(e.opts.controls.panOnArrowKeys)switch(t.source.key){case"ArrowUp":x(0,75);break;case"ArrowRight":x(-75,0);break;case"ArrowDown":x(0,-75);break;case"ArrowLeft":x(75,0)}},L=t=>{if(c)return;let o=Math.max(-1,Math.min(1,-t.source.deltaY));if(e.opts.controls.panOnWheel){if(e.dom.containerEl===document.activeElement||e.dom.containerEl.contains(document.activeElement)){let e=75*o;n.isModKeyActive("Shift")?x(e,0):x(0,e),v()}}else e.opts.controls.zoomOnWheel&&O(t.source)},M=e=>(e=null!=e?e:i.containerEl.getBoundingClientRect(),Math.max(Math.max(e.width/p,s.minScale),Math.max(e.height/u,s.minScale))),A=()=>{let e=i.containerEl.getBoundingClientRect(),t=M(e),n=Math.max(a.scale,t),o=p*n-e.width,r=u*n-e.height,s=-Math.min(o,Math.abs(a.x)),l=-Math.min(r,Math.abs(a.y));a.scale=n,a.x=s,a.y=l,v()},$=(C=A,S=!1,function(){S||(C(...arguments),S=!0,setTimeout((function(){S=!1}),500))});var C,S;n.on("dragstart",w),n.on("wheel",L),n.on("keydown",b),window.addEventListener("resize",$);const O=n=>{let o=i.containerEl.getBoundingClientRect(),r=Math.max(-1,Math.min(1,-n.deltaY)),l=n.pageX-i.containerEl.offsetLeft,d=n.pageY-i.containerEl.offsetTop,c=-(l-a.x)/a.scale,g=-(d-a.y)/a.scale,h=M(o),m=null==s?void 0:s.maxScale,f=parseFloat((a.scale+r*(null==s?void 0:s.scaleStep)).toFixed(2));if(f<h||f>m)return;let y=c*f+l,w=g*f+d,E=p*f-o.width,k=u*f-o.height;y>0&&(y=0),w>0&&(w=0),y<-E&&(y=-E),w<-k&&(w=-k),a.scale=f,a.x=y,a.y=w,v(!0),e.emit("transform",Object.assign({},a)),t.recordAction("transform")};return A(),{name:"panzoom",update:e=>{s=e.opts.panzoom,l=e.state,i=e.dom,a=l.transform},dispose:()=>{n.removeListener("dragstart",w),n.removeListener("drag",E),n.removeListener("dragend",k),n.removeListener("wheel",L),n.removeListener("keydown",b),window.removeEventListener("resize",$)}}}(y,w,k)),h.set("drag",function(e,t,o){let r=e.state,s=[],l=e.opts.drag.gridX||0,i=e.opts.drag.gridY||0,a=!1;const d=function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=0!==l?l*Math.floor(t.scaledDeltaX/l):t.scaledDeltaX,r=0!==i?i*Math.floor(t.scaledDeltaY/i):t.scaledDeltaY;a||0===o&&0===r||(a=!0),s.forEach((e=>{let t=0!==l?e.x%l:0,s=0!==i?e.y%i:0;if(n){let n=e.x+(o-t),l=e.y+(r-s);e.x=n,e.y=l,e.deltaX=0,e.deltaY=0}else e.deltaX=o-t,e.deltaY=r-s;E(e)})),x(e)},c=l=>{let i=t.resolveItem(l.source);((t,n)=>!o.isModActive("multiSelectModifier")&&0!==r.selected.size&&n&&"node"===n.type&&("mouse"!==t.pointerType||t.button===e.opts.controls.selectButton))(l.source,i)&&(s=Array.from(r.selected.values()).filter((e=>e.type===n.Node)),o.on("drag",p),o.on("dragend",u),a=!1,d(l))},p=e=>{d(e)},u=e=>{d(e,!0),s=[],o.removeListener("drag",p),o.removeListener("dragend",u),a&&t.recordAction("drag")};return o.on("dragstart",c),{name:"drag",update:e=>{r=e.state,l=e.opts.drag.gridX||0,i=e.opts.drag.gridY||0},dispose:()=>{o.removeListener("dragstart",c),o.removeListener("drag",p),o.removeListener("dragend",u)}}}(y,w,k)),h.set("linker",function(e,t,n){const o=e.state,s=e.dom;let a,d=null;const c=(t,n)=>{let r,a,c=o.transform,p=s.containerEl.getBoundingClientRect(),u=p.top,g=p.left,h=f(d,g,u),m=h.x,v=h.y;if(n){let e=f(n,g,u);r=e.x,a=e.y}else r=t.pageX-e.dom.containerEl.offsetLeft,a=t.pageY-e.dom.containerEl.offsetTop;m>r&&([m,r]=i(m,r),[v,a]=i(v,a)),s.ghostLinkEl.setAttribute("d",l((m-c.x)/c.scale,(v-c.y)/c.scale,(r-c.x)/c.scale,(a-c.y)/c.scale,e.opts.bezierWeight))},p=(t,n)=>t.isPrimary&&n&&"edge"===n.type&&("mouse"!==t.pointerType||t.button===e.opts.controls.selectButton),u=o=>{let r=t.resolveItem(o.source);p(o.source,r)&&(r=r,e.opts.beforeLinkStart(r)&&(d=r,s.ghostLinkEl.style.display="block",e.lock("linker"),c(o.source),n.on("move",g),n.on("up",h)))},g=e=>{if(e.source.isPrimary){let n=t.resolveItem(e.source);if(n&&n.key!==(null==d?void 0:d.key)&&"edge"===n.type)return a=n,t.isLinkValid(d,n)?(s.ghostLinkEl.classList.remove(r.LinkInvalid),s.ghostLinkEl.classList.add(r.LinkValid),n.el.classList.remove(r.EdgeInvalid),n.el.classList.add(r.EdgeValid)):(s.ghostLinkEl.classList.remove(r.LinkValid),s.ghostLinkEl.classList.add(r.LinkInvalid),n.el.classList.remove(r.EdgeValid),n.el.classList.add(r.EdgeInvalid)),void c(e.source,n);s.ghostLinkEl.classList.remove(r.LinkValid),s.ghostLinkEl.classList.remove(r.LinkInvalid),a&&(a.el.classList.remove(r.EdgeValid),a.el.classList.remove(r.EdgeInvalid),a=null),c(e.source)}},h=n=>{let o=t.resolveItem(n.source);n.source.isPrimary&&m(),p(n.source,o)&&(o=o,n.source.button===e.opts.controls.selectButton&&e.opts.beforeLinkEnd(d,o)&&t.isLinkValid(d,o)&&t.addLink(d.nodeKey,d.edgeKey,o.nodeKey,o.edgeKey))},m=()=>{s.ghostLinkEl.style.display="none",a&&(a.el.classList.remove(r.EdgeValid),a.el.classList.remove(r.EdgeInvalid),a=null),n.removeListener("move",g),n.removeListener("up",h),e.unlock()};return n.on("down",u),{name:"linker",dispose:()=>{n.removeListener("down",u),n.removeListener("move",g),n.removeListener("up",h)}}}(y,w,k)),h.set("context",function(e,t,n){const o=()=>t.closeContextMenu(),r=()=>t.closeContextMenu(),s=e=>{if(e.item){let n,o;[n,o]=t.pageToContainerPos(e.source.pageX,e.source.pageY),t.openContextMenu(n,o,e.item)}};return n.on("contextmenu",s),n.on("down",o),n.on("wheel",r),{name:"context",dispose:()=>{n.removeListener("contextmenu",s),n.removeListener("down",o),n.removeListener("wheel",r)}}}(0,w,k)),h.set("shortcut",function(e,t){const n=(e,n)=>{t.eventInGraph(e)&&(e.preventDefault(),e.stopPropagation(),console.log("UNDO"),t.undo())},o=(e,n)=>{t.eventInGraph(e)&&(e.preventDefault(),e.stopPropagation(),console.log("REDO"),t.redo())},r=(e,n)=>{t.eventInGraph(e)&&(e.preventDefault(),e.stopPropagation(),console.log("DELETE"),t.removedSelectedItems())};return U("delete",{element:e.dom.containerEl},r),U("ctrl+z, command+z",{element:e.dom.containerEl},n),U("ctrl+shift+z, command+shift+z, ctrl+y, command+y",{element:e.dom.containerEl},o),{name:"shortcut",dispose:()=>{U.unbind("delete",r),U.unbind("ctrl+z, command+z",n),U.unbind("ctrl+shift+z, command+shift+z, ctrl+y, command+y",o)}}}(y,w)),Object.assign({on(e,t){g.on(e,t)},removeListener(e,t){g.removeListener(e,t)},dispose:()=>{h.forEach((e=>{var t;return null===(t=e.dispose)||void 0===t?void 0:t.call(e)})),k.dispose(),m.clear()},setOptions:e=>{c=J(e),y.opts=c,h.forEach((e=>{var t;return null===(t=e.update)||void 0===t?void 0:t.call(e,y)}))},cancel:()=>{h.forEach((e=>{var t;return null===(t=e.cancel)||void 0===t?void 0:t.call(e)}))}},w)}return e.p,s})()}));