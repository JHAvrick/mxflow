/*! For license information please see mxflow.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mxflow=t():e.mxflow=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var o=n.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();var t,n,o,l,r={};e.r(r),e.d(r,{MXFlow:()=>Z}),function(e){e.TOP="top",e.RIGHT="right",e.LEFT="left",e.BOTTOM="bottom",e.CENTER="center"}(t||(t={})),function(e){e.None="none",e.Graph="graph",e.Link="link",e.Node="node",e.Edge="edge"}(n||(n={})),function(e){e.Type="data-mxflow-type",e.Key="data-mxflow-key",e.NodeTemplate="data-mxflow-node-template",e.NodeContent="data-mxflow-node-content",e.EdgeGroup="data-mxflow-edge-group",e.EdgeLatch="data-mxflow-edge-latch"}(o||(o={})),function(e){e.Container="mxflow-container",e.Root="mxflow-root",e.Background="mxflow-background",e.Dots="mxflow-dots",e.Grid="mxflow-grid",e.GridInner="mxflow-grid-inner",e.GridOuter="mxflow-grid-outer",e.Context="mxflow-context",e.ItemSelected="mxflow-item--selected",e.ItemPreselected="mxflow-item--preselected",e.Nodes="mxflow-nodes",e.Node="mxflow-node",e.NodeContent="mxflow-node-content",e.EdgeGroup="mxflow-edge-group",e.Edge="mxflow-edge",e.EdgeValid="mxflow-edge--valid",e.EdgeInvalid="mxflow-edge--invalid",e.Lasso="mxflow-lasso",e.Links="mxlflow-links",e.Link="mxflow-link",e.LinkInner="mxflow-link-inner",e.LinkOuter="mxflow-link-outer",e.LinkValid="mxflow-link--valid",e.LinkInvalid="mxflow-link--invalid",e.GhostLinks="mxflow-ghost-links",e.GhostLink="mxflow-ghost-link"}(l||(l={}));const s=(e,t,n,o,l)=>{let r=Math.abs(n-e)*l;return`M${e} ${t} C ${Math.max(e,n)-r} ${t} ${Math.min(e,n)+r} ${o} ${n} ${o}`},i=(e,t)=>{let n=e;return[e=t,t=n]},d=e=>JSON.parse(JSON.stringify(e)),a=(e,t,n)=>Math.min(Math.max(e,t),n),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return Object.keys(e).reduce(((o,l)=>Object.assign({},o,"[object Object]"===Object.prototype.toString.call(e[l])?c(e[l],t.concat([l]),n):{[t.concat([l]).join(n)]:e[l]})),{})},p=(e,t)=>e.split(".").reduce(((e,t)=>e?e[t]:null),t||self),u=(e,t,n)=>{let o=e.split(".");for(let e=0;e<o.length-1;e++)null!=t[o[e]]&&null!=t[o[e]]||(t[o[e]]={}),t=t[o[e]];t[o[o.length-1]]=n},g=`\n    <div ${o.NodeTemplate}>\n        <ul ${o.EdgeGroup}="inputs" ${o.EdgeLatch}="left">\n            \x3c!-- Input Edges Dynamically Populated --\x3e\n        </ul>\n        <div ${o.NodeContent}>\n            \x3c!-- Node Content as Provided by User --\x3e\n        </div>\n        <ul ${o.EdgeGroup}="outputs" ${o.EdgeLatch}="right">\n            \x3c!-- Output Edges Dynamically Populated --\x3e\n        </ul>\n    </div>\n`,v=e=>{let n=new Map;return e.querySelectorAll(`ul[${o.EdgeGroup}]`).forEach((e=>{var r;let s=e.getAttribute(o.EdgeGroup),i=(d=t,a=null!==(r=e.getAttribute(o.EdgeLatch))&&void 0!==r?r:"center",Object.values(d).includes(a)?a:void 0);var d,a;e.classList.add(l.EdgeGroup),n.set(s,{groupKey:s,groupEl:e,latchPos:null!=i?i:t.CENTER})})),n},h=(new Set(Object.values(l)),e=>{var t,r,s,i;let d,a,c,p=null!==(t=e.template)&&void 0!==t?t:g;if([d,a,c]=(e=>{let t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelector(`*[${o.NodeTemplate}]`),l=t.querySelector(`*[${o.NodeContent}]`);if(!n||!l)throw new Error("Node template is missing required element.");if(!(n instanceof HTMLElement&&l instanceof HTMLElement))throw new Error("One more more template elements is of the incorrect element type.");return[t,n,l]})(p),!a||!c)throw new Error("Node template is missing required element.");if(!(a instanceof HTMLElement&&c instanceof HTMLElement))throw new Error("One more more template elements is of the incorrect element type.");if(!(a instanceof HTMLElement))throw new Error('No parent HTMLElement found in Node template (w/ class "mx-flow-node").');return((e,t,l)=>{e.setAttribute(o.Type,n.Node),e.setAttribute(o.Key,t),e.setAttribute("draggable","false"),e.ondragstart=e=>e.preventDefault(),e.style.display="inline-flex",e.style.justifyContent="space-between",e.style.touchAction="none",e.style.userSelect="none",e.style.pointerEvents="all",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.zIndex=l.toString()})(a,e.key,e.z),a.classList.add(l.Node),c.classList.add(l.NodeContent),e.nodeClass&&e.nodeClass.length>0&&a.classList.add(e.nodeClass),e.width&&(a.style.width="number"==typeof e.width?`${e.width}px`:e.width),e.height&&(a.style.height="number"==typeof e.height?`${e.height}px`:e.height),{type:n.Node,template:p,key:e.key,el:a,contentEl:c,edgeGroups:v(d),x:e.x,y:e.y,z:e.z,deltaX:0,deltaY:0,width:null!==(r=e.width)&&void 0!==r?r:"auto",height:null!==(s=e.height)&&void 0!==s?s:"auto",data:null!==(i=e.data)&&void 0!==i?i:{}}}),f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e.el.getBoundingClientRect();switch(e.group.latchPos.toString()){case"top":return{x:o.left-t+o.width/2,y:o.top-n};case"right":return{x:o.left-t+o.width,y:o.top-n+o.height/2};case"bottom":return{x:o.left-t+o.width/2,y:o.top-n+o.height};case"left":return{x:o.left-t,y:o.top-n+o.height/2};default:return{x:o.left-t+o.width/2,y:o.top-n+o.height/2}}},m=e=>`${e.fromNode}:${e.fromEdge}:${e.toNode}:${e.toEdge}`,y=(e,t)=>{switch(!0){case Array.isArray(e):case e instanceof Map:e.forEach((e=>e.el.classList.add(t)));break;default:e.el.classList.add(t)}},E=(e,t)=>{switch(!0){case Array.isArray(e):case e instanceof Map:e.forEach((e=>e.el.classList.remove(t)));break;default:e.el.classList.remove(t)}},w=e=>(e.el.style.transform=`translate(${e.x+e.deltaX}px, ${e.y+e.deltaY}px)`,e),k=(e,t)=>{var n;let o=e.state.transform,l=e.state.edges.get(`${t.fromNode}:${t.fromEdge}`),r=e.state.edges.get(`${t.toNode}:${t.toEdge}`);if(!l||!r)throw new Error("MXFlow.applyLinkPosition(): Cannot apply link position for undefined edge");let d=e.dom.containerEl.getBoundingClientRect(),a=d.top,c=d.left,p=f(l,c,a),u=f(r,c,a),g=p.x,v=p.y,h=u.x,m=u.y;g>h&&([g,h]=i(g,h),[v,m]=i(v,m));let y=s((g-o.x)/o.scale,(v-o.y)/o.scale,(h-o.x)/o.scale,(m-o.y)/o.scale,null!==(n=e.opts.bezierWeight)&&void 0!==n?n:.675);t.outerEl.setAttribute("d",y),t.innerEl.setAttribute("d",y),t.labelEl.setAttribute("d",y)},x=e=>{e.state.links.forEach((t=>k(e,t)))};class b{constructor(){this.events={}}on(e,t){return"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){if("object"!=typeof this.events[e])return;const n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}removeAllListeners(){Object.keys(this.events).forEach((e=>this.events[e].splice(0,this.events[e].length)))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];"object"==typeof this.events[e]&&[...this.events[e]].forEach((e=>e.apply(this,n)))}once(e,t){var n=this;const o=this.on(e,(function(){o();for(var e=arguments.length,l=new Array(e),r=0;r<e;r++)l[r]=arguments[r];t.apply(n,l)}));return o}}Object.create,Object.create;const L={x:0,y:0,suppressEvent:!1,ignoreAction:!1,edges:[]},$=e=>{const t=e.dom,r=e.state,s=e.state.transform,i=e.emit,a=t=>{var n,o,l;console.log(t),(null===(n=e.opts.undo)||void 0===n?void 0:n.enabled)&&(null===(l=null===(o=e.opts.undo)||void 0===o?void 0:o.actions)||void 0===l?void 0:l.includes(t))&&(r.undo.unshift({type:t,model:K()}),r.undo.length>50&&r.undo.pop(),r.redo=[])},c=(e,t)=>{e.forEach((e=>{r.selected.set(e.key,e),y(e,l.ItemSelected)})),u(Array.from(e.values()).filter((e=>"node"===e.type))),(null==t?void 0:t.suppressEvent)||i("selected",new Map(r.selected)),(null==t?void 0:t.ignoreAction)||a("select")},p=(e,t)=>{e.forEach((e=>{let t=r.selected.get(e);t&&(E(t,l.ItemSelected),r.selected.delete(e))})),(null==t?void 0:t.suppressEvent)||i("selected",new Map(r.selected)),(null==t?void 0:t.ignoreAction)||a("select")},u=t=>{let n=t.sort(((e,t)=>e.z>t.z?1:-1)),o=new Set(n),l=Array.from(r.nodes.values()).sort(((e,t)=>e.z>t.z?1:-1)),s=e.opts.zIndexStart;l.forEach((e=>{o.has(e)||(e.z=s,e.el.style.zIndex=e.z.toString(),s+=1)}));let i=s+n.length;n.forEach(((e,t)=>{e.z=i+t,e.el.style.zIndex=e.z.toString()}))},g=(e,t,n)=>{let o=v(e,t);if(o)switch(o.type){case"node":return void M(o.key,n);case"link":return void S(o.key,n);case"edge":return void b(o.key,n)}},v=(e,t)=>{let n;return"graph"===e?r.root:(t&&"node"===e?n=r.nodes.get(t):t&&"edge"===e?n=r.edges.get(t):t&&"link"===e&&(n=r.links.get(t)),n)},f=e=>{var n,o,r;return(null===(r=null===(o=null===(n=e.target)||void 0===n?void 0:n.closest)||void 0===o?void 0:o.call(n,`.${l.Container}`))||void 0===r?void 0:r.id)===t.instanceId},x=(e,t,s,d)=>{let c=`${t}:${s}`;if(!r.edges.has(c)){let p=r.nodes.get(t);if(p){let t=((e,t,r,s)=>{let i=e.edgeGroups.get(t);if(!i)throw new Error(`createEdge(): Unable to find group with key "${t}" in node template.`);let d=document.createElement("li");return d.classList.add(l.Edge),d.setAttribute(o.Type,n.Edge),d.setAttribute(o.Key,`${e.key}:${r}`),d.setAttribute("draggable","false"),d.ondragstart=e=>e.preventDefault(),s&&s.length>0&&d.classList.add(s),{type:n.Edge,key:`${e.key}:${r}`,group:i,nodeKey:e.key,edgeKey:r,el:d,data:{}}})(p,e,s,null==d?void 0:d.class);return t.data=(null==d?void 0:d.data)||{},r.edges.set(c,t),T(t),t.group.groupEl.appendChild(t.el),(null==d?void 0:d.suppressEvent)||i("edgeAdded",t),(null==d?void 0:d.ignoreAction)||a("addEdge"),t}throw new Error(`MXFlow: Attempted to add edge to node which doesn't exist (key="${c}")`)}throw new Error(`MXFlow: Attempted to add edge with a key that already exists (key="${c}")`)},b=(t,n)=>{let o=r.edges.get(t);if(o){if(e.opts.beforeEdgeRemoved&&!e.opts.beforeEdgeRemoved(o))return;return o.el.remove(),r.edges.delete(t),(null==n?void 0:n.suppressEvent)||i("edgeRemoved",o),void((null==n?void 0:n.ignoreAction)||a("removeEdge"))}throw new Error(`MXFlow: No edge exists with key="${t}"`)},$=function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var l,s,d;let c=Object.assign(Object.assign({},L),o);if(!r.nodes.has(n)){let p=h({template:e.opts.nodeHTMLTemplate,key:n,x:null!==(l=c.x)&&void 0!==l?l:0,y:null!==(s=c.y)&&void 0!==s?s:0,z:r.nodes.size+1,width:c.width,height:c.height,nodeClass:c.class,data:c.data});return r.nodes.set(n,p),null===(d=o.edges)||void 0===d||d.forEach((e=>{x(e.group,n,e.key,{data:e.data,class:e.class,suppressEvent:!0,ignoreAction:!0})})),T(p),t.nodeContainerEl.appendChild(p.el),w(p),(null==c?void 0:c.suppressEvent)||i("nodeAdded",p),void((null==c?void 0:c.ignoreAction)||a("addNode"))}throw new Error(`MXFlow: Attempted to add a node with a key that already exists (key="${n}")`)},M=(t,n)=>{let o=r.nodes.get(t);if(o){if(e.opts.beforeNodeRemoved&&!e.opts.beforeNodeRemoved(o))return;return r.selected.has(t)&&p([t],{suppressEvent:!0,ignoreAction:!0}),r.links.forEach((e=>{e.fromNode!==(null==o?void 0:o.key)&&e.toNode!==(null==o?void 0:o.key)||(e.el.remove(),r.links.delete(e.key))})),r.edges.forEach((e=>{e.nodeKey===(null==o?void 0:o.key)&&(e.el.remove(),r.edges.delete(e.key))})),o.el.remove(),r.nodes.delete(t),(null==n?void 0:n.suppressEvent)||i("nodeRemoved",o),void((null==n?void 0:n.ignoreAction)||a("removeNode"))}throw new Error(`MXFlow: No node exists with key="${t}"`)},C=(s,d,c,p,u)=>{let g={fromNode:s,fromEdge:d,toNode:c,toEdge:p},v=r.edges.get(`${s}:${d}`),h=r.edges.get(`${c}:${p}`);if(!v||!h)throw new Error(`MXFlow.addLink(): One or both edges missing "${d}", "${p}"`);if(!A(v,h))throw new Error("MXFlow.addLink(): Invalid link.");let f=m(g);if(!r.links.has(f)){let s=((e,t)=>{let r=m(e),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.classList.add(l.LinkInner),s.style.pointerEvents="none";let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.classList.add(l.LinkOuter),i.style.pointerEvents="auto";let d=document.createElementNS("http://www.w3.org/2000/svg","text");d.textContent="Label",d.style.color="white",d.setAttribute("width","300px"),d.setAttribute("height","300px"),d.setAttribute("textAnchor","middle");let a=document.createElementNS("http://www.w3.org/2000/svg","textPath");a.style.pointerEvents="none",d.appendChild(a);let c=document.createElementNS("http://www.w3.org/2000/svg","g");return c.setAttribute(o.Type,n.Link),c.setAttribute(o.Key,r),c.classList.add(l.Link),c.style.pointerEvents="none",c.setAttribute("draggable","false"),c.ondragstart=e=>e.preventDefault(),c.appendChild(s),c.appendChild(i),c.appendChild(d),t&&t.length>0&&c.classList.add(t),{type:n.Link,key:r,fromNode:e.fromNode,fromEdge:e.fromEdge,toNode:e.toNode,toEdge:e.toEdge,el:c,innerEl:s,outerEl:i,labelEl:a,data:{}}})(g,null==u?void 0:u.class);return s.data=(null==u?void 0:u.data)||{},r.links.set(f,s),t.linkContainerEl.appendChild(s.el),k(e,s),(null==u?void 0:u.suppressEvent)||i("linkAdded",s),void((null==u?void 0:u.ignoreAction)||a("addLink"))}throw new Error(`MXFlow: Attempted to add link which already exists (key="${f}")`)},S=(t,n)=>{let o=r.links.get(t);if(o){if(e.opts.beforeLinkRemoved&&!e.opts.beforeLinkRemoved(o))return;return r.selected.has(t)&&p([t],{suppressEvent:!0,ignoreAction:!0}),o.el.remove(),r.links.delete(t),(null==n?void 0:n.suppressEvent)||i("linkRemoved",o),void((null==n?void 0:n.ignoreAction)||a("removeLink"))}},A=(t,n)=>!(!t||!n||t.nodeKey===n.nodeKey||t.group.groupKey===n.group.groupKey||r.links.has(`${t.nodeKey}:${t.edgeKey}:${n.nodeKey}:${n.edgeKey}`)||r.links.has(`${n.nodeKey}:${n.edgeKey}:${t.nodeKey}:${t.edgeKey}`)||e.opts.linkValidator&&!e.opts.linkValidator(t,n)),O=e=>{r.preselected.clear(),r.selected.clear(),r.nodes.clear(),r.edges.clear(),r.links.clear(),t.linkContainerEl.innerHTML="",t.nodeContainerEl.innerHTML="",(null==e?void 0:e.suppressEvent)||i("cleared"),(null==e?void 0:e.ignoreAction)||a("clear")},K=()=>{let e={transform:r.transform,nodes:{},links:{},edges:{}};return r.nodes.forEach((t=>{e.nodes[t.key]={selected:r.selected.has(t.key),x:t.x,y:t.y,width:t.width,height:t.height,data:t.data}})),r.edges.forEach((t=>{e.edges[t.key]={nodeKey:t.nodeKey,edgeKey:t.edgeKey,groupKey:t.group.groupKey,data:t.data}})),r.links.forEach((t=>{e.links[t.key]={selected:r.selected.has(t.key),fromNode:t.fromNode,fromEdge:t.fromEdge,toNode:t.toNode,toEdge:t.toEdge,data:t.data}})),e},N=e=>{return t=void 0,n=void 0,l=function*(){return O({suppressEvent:!0,ignoreAction:!0}),Object.entries(e.nodes).forEach((e=>{$(e[0],{x:e[1].x,y:e[1].y,width:e[1].width,height:e[1].height,suppressEvent:!1,ignoreAction:!0}),e[1].selected&&c([r.nodes.get(e[0])],{ignoreAction:!0})})),Object.entries(e.edges).forEach((e=>{x(e[1].groupKey,e[1].nodeKey,e[1].edgeKey,{ignoreAction:!0})})),new Promise((t=>{requestAnimationFrame((()=>{Object.entries(e.links).forEach((e=>{C(e[1].fromNode,e[1].fromEdge,e[1].toNode,e[1].toEdge,{ignoreAction:!0}),e[1].selected&&c([r.links.get(e[0])],{ignoreAction:!0})})),t(null)}))}))},new((o=void 0)||(o=Promise))((function(e,r){function s(e){try{d(l.next(e))}catch(e){r(e)}}function i(e){try{d(l.throw(e))}catch(e){r(e)}}function d(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,i)}d((l=l.apply(t,n||[])).next())}));var t,n,o,l},T=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.opts.render){let l=e.renderCache.get(t.key),r=null,s=e.opts.render(t,l,o);if(t.type===n.Node?r=t.contentEl:t.type===n.Edge&&(r=t.el),!r)return;s&&(r.innerHTML="","string"==typeof s?r.insertAdjacentHTML("afterbegin",s):r.appendChild(s),e.renderCache.set(t.key,r.firstElementChild))}},P=n=>{var o,l,r,d,a,c;if(e.isLocked())return;let p=t.rootEl.getBoundingClientRect(),u=s.scale,g=(null===(o=e.opts.panzoom)||void 0===o?void 0:o.minScale)||.05,v=(null===(l=e.opts.panzoom)||void 0===l?void 0:l.maxScale)||2,h=(null===(r=e.opts.panzoom)||void 0===r?void 0:r.scaleStep)||.25,f=null!==(d=n.x)&&void 0!==d?d:s.x,m=null!==(a=n.y)&&void 0!==a?a:s.y,y=s.scale;n.scale?y=n.scale:n.scaleSteps&&(y=parseFloat((u+n.scaleSteps*h).toFixed(2))),(y<g||y>v)&&(y=s.scale);let E=-f*y,w=-m*y,k=t.containerEl.getBoundingClientRect(),x=p.width-k.width,b=p.height-k.height;E>0&&(E=0),w>0&&(w=0),E<-x&&(E=-x),w<-b&&(w=-b),e.state.transform.scale=y,e.state.transform.x=E,e.state.transform.y=w,function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];"number"!=typeof e&&!0!==e||(t.rootEl.style.transition=`transform ${"number"==typeof e?e:300}ms`),t.rootEl.style.transform=`translate(${s.x}px, ${s.y}px) scale(${s.scale})`}(null===(c=n.transition)||void 0===c||c),n.suppressEvent||i("transform",Object.assign({},s))};return{recordAction:a,undo:()=>{var t;console.log("UNDO"),(null===(t=e.opts.undo)||void 0===t?void 0:t.enabled)&&r.undo.length>1&&(r.undo.length>0&&r.redo.unshift(r.undo.shift()),N(d(r.undo[0].model)))},redo:()=>{var t;(null===(t=e.opts.undo)||void 0===t?void 0:t.enabled)&&r.redo.length>0&&(r.redo.length>0&&r.undo.unshift(r.redo.shift()),N(d(r.undo[0].model)))},addEdge:x,removeEdge:b,addNode:$,removeNode:M,addLink:C,removeLink:S,isLinkValid:A,isSelected:e=>{let t="string"==typeof e?e:e.key;return r.selected.has(t)},setSelected:(e,t)=>{let n=Array.isArray(e)?new Map(e.map((e=>[e.key,e]))):e;0===r.selected.size&&0===n.size||(E(r.selected,l.ItemSelected),r.selected=n,y(r.selected,l.ItemSelected),0!==n.size&&r.selected.size<r.nodes.size&&u(Array.from(e.values()).filter((e=>"node"===e.type)))),(null==t?void 0:t.suppressEvent)||i("selected",new Map(r.preselected)),(null==t?void 0:t.ignoreAction)||a("select")},setPreselected:(e,t)=>{let n=Array.isArray(e)?new Map(e.map((e=>[e.key,e]))):e;0===r.preselected.size&&0===n.size||(E(r.preselected,l.ItemPreselected),r.preselected=n,y(r.preselected,l.ItemPreselected)),(null==t?void 0:t.suppressEvent)||i("preselected",new Map(r.preselected))},addToSelection:c,removeFromSelection:p,removeItem:g,removedSelectedItems:e=>{let t=r.selected.size>1;r.selected.forEach((n=>{g(n.type,n.key,{suppressEvent:null==e?void 0:e.suppressEvent,ignoreAction:(null==e?void 0:e.ignoreAction)||t})})),!(null==e?void 0:e.ignoreAction)&&t&&a("removeItems")},openContextMenu:(n,o,l,s)=>{(n=>{var o,l;let r=t.contextEl,s=null===(l=(o=e.opts).renderContext)||void 0===l?void 0:l.call(o,n);s&&(r.innerHTML="","string"==typeof s?r.insertAdjacentHTML("afterbegin",s):r.appendChild(s))})(l),t.contextEl.style.left=`${n}px`,t.contextEl.style.top=`${o}px`,t.contextEl.style.display="block",r.contextOpen=!0,(null==s?void 0:s.suppressEvent)||i("contextOpened",l)},closeContextMenu:e=>{t.contextEl.style.display="none",r.contextOpen=!1,(null==e?void 0:e.suppressEvent)||i("contextClosed")},getItem:v,resolveItem:e=>{if(!f(e))return;let t,n=document.elementFromPoint(e.clientX,e.clientY);if(n){let e=n.closest(`[${o.Type}]`);e&&(e.getAttribute,t=v(e.getAttribute(o.Type),e.getAttribute(o.Key)))}return t},clear:O,getModel:K,setModel:N,getDom:()=>e.dom,getState:()=>e.state,getNodes:()=>new Map(r.nodes),getEdges:()=>new Map(r.edges),getLinks:()=>new Map(r.links),eventInGraph:f,pageToContainerPos:(e,n)=>[e-t.containerEl.offsetLeft,n-t.containerEl.offsetTop],pageToGraphPos:(e,n)=>[(Math.abs(s.x)+(e-t.containerEl.offsetLeft))/s.scale,(Math.abs(s.y)+(n-t.containerEl.offsetTop))/s.scale],setView:P,focus:(e,n)=>{let o=t.containerEl.getBoundingClientRect(),l=e.el.getBoundingClientRect(),r=e.x,i=e.y,d=l.width/s.scale,a=l.height/s.scale,c=o.width/s.scale,p=o.height/s.scale;P({x:r+(d-c)/2,y:i+(a-p)/2,scale:null!=n?n:s.scale})},render:T,renderAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Array.from(r.nodes.values());t.concat(Array.from(r.edges.values())),t.forEach((t=>T(t,e)))},getCompositeScale:()=>e.opts.parent?e.opts.parent.getCompositeScale()+e.state.transform.scale:e.state.transform.scale}},M=function(e,t){const n=e.state,o=e.dom;let r,d=!1,a=null;const c=(t,l)=>{let r,d,c=n.transform,p=o.containerEl.getBoundingClientRect(),u=p.top,g=p.left,v=f(a,g,u),h=v.x,m=v.y;if(l){console.log(l);let e=f(l,g,u);r=e.x,d=e.y}else r=t.pageX-e.dom.containerEl.offsetLeft,d=t.pageY-e.dom.containerEl.offsetTop;h>r&&([h,r]=i(h,r),[m,d]=i(m,d)),o.ghostLinkEl.setAttribute("d",s((h-c.x)/c.scale,(m-c.y)/c.scale,(r-c.x)/c.scale,(d-c.y)/c.scale,e.opts.bezierWeight))},p=(t,n)=>t.isPrimary&&n&&"edge"===n.type&&("mouse"!==t.pointerType||t.button===e.opts.select.button);return{name:"linker",onDown:(t,n)=>{if(!d&&p(t,n)){if(n=n,!e.opts.beforeLinkStart(n))return;d=!0,a=n,o.ghostLinkEl.style.display="block",e.lock("linker"),c(t)}},onMove:e=>{if(e.isPrimary&&d){let n=t.resolveItem(e);if(n&&n.key!==(null==a?void 0:a.key)&&"edge"===n.type)return r=n,t.isLinkValid(a,n)?(o.ghostLinkEl.classList.remove(l.LinkInvalid),o.ghostLinkEl.classList.add(l.LinkValid),n.el.classList.remove(l.EdgeInvalid),n.el.classList.add(l.EdgeValid)):(o.ghostLinkEl.classList.remove(l.LinkValid),o.ghostLinkEl.classList.add(l.LinkInvalid),n.el.classList.remove(l.EdgeValid),n.el.classList.add(l.EdgeInvalid)),void c(e,n);o.ghostLinkEl.classList.remove(l.LinkValid),o.ghostLinkEl.classList.remove(l.LinkInvalid),r&&(r.el.classList.remove(l.EdgeValid),r.el.classList.remove(l.EdgeInvalid),r=null),c(e)}},onUp:(n,s)=>{d&&(n.isPrimary&&(d=!1,o.ghostLinkEl.style.display="none",r&&(r.el.classList.remove(l.EdgeValid),r.el.classList.remove(l.EdgeInvalid),r=null),e.unlock()),p(n,s)&&(s=s,n.button===e.opts.select.button&&e.opts.beforeLinkEnd(a,s)&&t.isLinkValid(a,s)&&t.addLink(a.nodeKey,a.edgeKey,s.nodeKey,s.edgeKey)))}}};var C="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function S(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function A(e,t){for(var n=t.slice(0,t.length-1),o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function O(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var K={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":C?173:189,"=":C?61:187,";":C?59:186,"'":222,"[":219,"]":221,"\\":220},N={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},T={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},P={16:!1,18:!1,17:!1,91:!1},z={},I=1;I<20;I++)K["f".concat(I)]=111+I;var j=[],D="all",X=[],G=function(e){return K[e.toLowerCase()]||N[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function R(e){D=e||"all"}function U(){return D||"all"}var Y=function(e){var t=e.key,n=e.scope,o=e.method,l=e.splitKey,r=void 0===l?"+":l;O(t).forEach((function(e){var t=e.split(r),l=t.length,s=t[l-1],i="*"===s?"*":G(s);if(z[i]){n||(n=U());var d=l>1?A(N,t):[];z[i]=z[i].map((function(e){return o&&e.method!==o||e.scope!==n||!function(e,t){for(var n=e.length>=t.length?e:t,o=e.length>=t.length?t:e,l=!0,r=0;r<n.length;r++)-1===o.indexOf(n[r])&&(l=!1);return l}(e.mods,d)?e:{}}))}}))};function B(e,t,n){var o;if(t.scope===n||"all"===t.scope){for(var l in o=t.mods.length>0,P)Object.prototype.hasOwnProperty.call(P,l)&&(!P[l]&&t.mods.indexOf(+l)>-1||P[l]&&-1===t.mods.indexOf(+l))&&(o=!1);(0!==t.mods.length||P[16]||P[18]||P[17]||P[91])&&!o&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function F(e){var t=z["*"],n=e.keyCode||e.which||e.charCode;if(H.filter.call(this,e)){if(93!==n&&224!==n||(n=91),-1===j.indexOf(n)&&229!==n&&j.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=T[t];e[t]&&-1===j.indexOf(n)?j.push(n):!e[t]&&j.indexOf(n)>-1?j.splice(j.indexOf(n),1):"metaKey"===t&&e[t]&&3===j.length&&(e.ctrlKey||e.shiftKey||e.altKey||(j=j.slice(j.indexOf(n))))})),n in P){for(var o in P[n]=!0,N)N[o]===n&&(H[o]=!0);if(!t)return}for(var l in P)Object.prototype.hasOwnProperty.call(P,l)&&(P[l]=e[T[l]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===j.indexOf(17)&&j.push(17),-1===j.indexOf(18)&&j.push(18),P[17]=!0,P[18]=!0);var r=U();if(t)for(var s=0;s<t.length;s++)t[s].scope===r&&("keydown"===e.type&&t[s].keydown||"keyup"===e.type&&t[s].keyup)&&B(e,t[s],r);if(n in z)for(var i=0;i<z[n].length;i++)if(("keydown"===e.type&&z[n][i].keydown||"keyup"===e.type&&z[n][i].keyup)&&z[n][i].key){for(var d=z[n][i],a=d.splitKey,c=d.key.split(a),p=[],u=0;u<c.length;u++)p.push(G(c[u]));p.sort().join("")===j.sort().join("")&&B(e,d,r)}}}function H(e,t,n){j=[];var o=O(e),l=[],r="all",s=document,i=0,d=!1,a=!0,c="+";for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(r=t.scope),t.element&&(s=t.element),t.keyup&&(d=t.keyup),void 0!==t.keydown&&(a=t.keydown),"string"==typeof t.splitKey&&(c=t.splitKey)),"string"==typeof t&&(r=t);i<o.length;i++)l=[],(e=o[i].split(c)).length>1&&(l=A(N,e)),(e="*"===(e=e[e.length-1])?"*":G(e))in z||(z[e]=[]),z[e].push({keyup:d,keydown:a,scope:r,mods:l,shortcut:o[i],method:n,key:o[i],splitKey:c});void 0!==s&&!function(e){return X.indexOf(e)>-1}(s)&&window&&(X.push(s),S(s,"keydown",(function(e){F(e)})),S(window,"focus",(function(){j=[]})),S(s,"keyup",(function(e){F(e),function(e){var t=e.keyCode||e.which||e.charCode,n=j.indexOf(t);if(n>=0&&j.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&j.splice(0,j.length),93!==t&&224!==t||(t=91),t in P)for(var o in P[t]=!1,N)N[o]===t&&(H[o]=!1)}(e)})))}var _={setScope:R,getScope:U,deleteScope:function(e,t){var n,o;for(var l in e||(e=U()),z)if(Object.prototype.hasOwnProperty.call(z,l))for(n=z[l],o=0;o<n.length;)n[o].scope===e?n.splice(o,1):o++;U()===e&&R(t||"all")},getPressedKeyCodes:function(){return j.slice(0)},isPressed:function(e){return"string"==typeof e&&(e=G(e)),-1!==j.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,n=t.tagName,o=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(o=!1),o},unbind:function(e){if(e){if(Array.isArray(e))e.forEach((function(e){e.key&&Y(e)}));else if("object"==typeof e)e.key&&Y(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var l=n[0],r=n[1];"function"==typeof l&&(r=l,l=""),Y({key:e,scope:l,method:r,splitKey:"+"})}}else Object.keys(z).forEach((function(e){return delete z[e]}))}};for(var V in _)Object.prototype.hasOwnProperty.call(_,V)&&(H[V]=_[V]);if("undefined"!=typeof window){var q=window.hotkeys;H.noConflict=function(e){return e&&window.hotkeys===H&&(window.hotkeys=q),H},window.hotkeys=H}const W=H,J={width:5e3,height:5e3,zIndexStart:100,showGrid:!0,gridSize:32,bezierWeight:.675,beforeLinkStart:()=>!0,beforeLinkEnd:()=>!0,beforeNodeRemoved:()=>!0,beforeEdgeRemoved:()=>!0,beforeLinkRemoved:()=>!0,renderContext:()=>{},render:()=>{},background:{type:"dots",size:15,html:""},drag:{cancelSelector:"",handleSelector:"",gridX:0,gridY:0,latchThreshold:5},select:{button:0,allowMultiselect:!0,multiSelectKey:"Shift"},undo:{enabled:!0,max:50,actions:["drag","addEdge","removeEdge","addLink","removeLink","addNode","removeNode","removeItems","clear","select"]},lasso:{enabled:!0},panzoom:{enabled:!0,minScale:.5,maxScale:2,scaleStep:.25,scale:1,x:0,y:0,panCursor:"grab",controls:{panButton:1}}},Q=e=>{var t;let n={},o=c(J);for(let l in o)u(l,n,null!==(t=p(l,e))&&void 0!==t?t:p(l,J));return n};function Z(e,t){var r,s;let i=Q(t);const d=((e,t)=>{let n="mxflow-instance-"+Date.now(),r=t.background.html;return"grid"!==t.background.type&&"dots"!==t.background.type||(r=((e,t)=>{let n="";if("grid"===e){let e=t||32,o=10*e;n=`\n            <defs>\n                <pattern id="smallGrid" width="${e}" height="${e}" patternUnits="userSpaceOnUse">\n                    <path class="${l.GridInner}" d="M ${e} 0 L 0 0 0 ${e}" fill="none" stroke="#273558" stroke-width="0.5"/>\n                </pattern>\n                <pattern id="grid" width="${o}" height="${o}" patternUnits="userSpaceOnUse">\n                    <rect width="${o}" height="${o}" fill="url(#smallGrid)" />\n                    <path class="${l.GridOuter}" d="M ${o} 0 L 0 0 0 ${o}" fill="none" stroke="#273558" stroke-width="1"/>\n                </pattern>\n            </defs>\n            <rect width="100%" height="100%" fill="url(#grid)" />\n        `}else{let e=t||15;n=`\n            <pattern id="mxflow-dot-pattern" x="0" y="0" width="${e}" height="${e}" patternUnits="userSpaceOnUse">\n                <circle cx="0.4" cy="0.4" r="0.4" fill="#81818a"></circle>\n            </pattern>\n            <rect x="0" y="0" width="100%" height="100%" fill="url(#mxflow-dot-pattern)"></rect>\n        `}return`\n        <svg class="${"grid"===e?l.Grid:l.Dots}" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" \n            style="position:absolute; top:0; left:0; pointer-events:none; opacity:.5; display:block;'">\n            ${n}\n        </svg>\n    `})(t.background.type,t.background.size)),e.insertAdjacentHTML("afterbegin",`\n        <div id="${n}" class="${l.Container}"\n            tabindex="1" \n            style="position:relative; display:block; width:100%; height:100%; overflow:hidden; pointer-events:auto; padding:0px; outline:none"\n            ondragstart="event.preventDefault()">\n            <div class="${l.Lasso}"\n                ondragstart="event.preventDefault()"\n                style="position:absolute; display:none; z-index: 3; pointer-events:none;">\n            </div>\n            <div class="${l.Context}"\n                ondragstart="event.preventDefault()"\n                style="display:none; position:absolute; z-index: 10;">\n                \x3c!-- Context Menu Populated Here --\x3e\n            </div>\n            <div class="${l.Root}"\n                ${o.Type}="graph"\n                ${o.Key}="graph"\n                ondragstart="event.preventDefault()"\n                style="position:relative; height:${t.height}px; width:${t.width}px; pointer-events:auto; transform-origin: 0 0; touch-action: none;">\n\n                <div class="${l.Background}" style="width:100%;height:100%;display:${"none"===t.background.type?"none":"block"};">\n                    ${r}\n                </div>\n                <svg class="${l.Links}" \n                        ondragstart="event.preventDefault()"\n                        style="position:absolute; left:0px; top:0px; width:100%; height:100%; pointer-events:none; padding: 0px;">\n                        \x3c!-- Links Populated Here --\x3e\n                </svg>\n                <svg class="${l.GhostLinks}" \n                     ondragstart="event.preventDefault()"\n                     style="position:absolute; left:0px; top:0px; width:100%; height:100%; pointer-events:none; padding: 0px; z-index:1000;">\n                     <g style="position:absolute; pointer-events:none; overflow:visible; ">\n                        <path class="${l.GhostLink}" style="display:none;"></path>\n                     </g>\n                </svg>\n                <div class="${l.Nodes}">\n                    \x3c!-- Nodes Populated Here --\x3e\n                </div>\n            </div>\n        </div>\n    `),{instanceId:n,containerEl:e.querySelector("."+l.Container),lassoEl:e.querySelector("."+l.Lasso),contextEl:e.querySelector("."+l.Context),rootEl:e.querySelector("."+l.Root),nodeContainerEl:e.querySelector("."+l.Nodes),linkContainerEl:e.querySelector("."+l.Links),ghostLinkContainerEl:e.querySelector("."+l.GhostLinks),ghostLinkEl:e.querySelector("."+l.GhostLink)}})(e,i),c=(e=>({root:{key:"graph",type:n.Graph,el:e.rootEl},nodes:new Map,edges:new Map,links:new Map,preselected:new Map,selected:new Map,contextOpen:!1,multi:!1,undo:[],redo:[],transform:{x:0,y:0,scale:1}}))(d),p=new b,u=new Map,g=new Map;let v=!1;const h={tools:u,opts:i,dom:d,state:c,emit:(e,t)=>{p.emit(e,t)},lock:e=>{!v&&u.has(e)&&(v=u.get(e))},unlock:()=>v=!1,isLocked:e=>!1!==v&&v.name!==e,renderCache:g},f=$(h),m=(e=>{const t=new b,n=(e,n)=>{t.emit(e,n)},o={thresholdMs:25,lastTarget:null,timeout:null},l={thresholdPx:3,startEvent:null,latched:!1},r=(t,n)=>{let o=t.clientX-l.startEvent.clientX,r=t.clientY-l.startEvent.clientY;return{source:null!=n?n:t,deltaX:o,deltaY:r,scaledDeltaX:o/e.state.transform.scale,scaledDeltaY:r/e.state.transform.scale}},s=e=>{o.lastTarget?e.target===o.lastTarget?n("doubletap",{source:e}):window.clearTimeout(o.timeout):(o.lastTarget=e.target,o.timeout=window.setTimeout((()=>o.lastTarget=null),o.thresholdMs)),e.isPrimary&&(l.startEvent=e)},i=e=>{e.isPrimary&&l.startEvent&&(l.latched?n("drag",r(e)):(e=>{let t=e.clientX-l.startEvent.clientX,n=e.clientY-l.startEvent.clientY;return Math.abs(t)>l.thresholdPx||Math.abs(n)>l.thresholdPx})(e)&&(n("dragstart",r(l.startEvent,l.startEvent)),l.startEvent=e,l.latched=!0)),n("move",{source:e})},d=e=>{l.startEvent&&e.isPrimary&&(l.latched&&n("dragend",r(e)),l.latched=!1,l.startEvent=null)},a=e=>{n("doubletap",{source:e})};return document.addEventListener("pointerdown",s),document.addEventListener("pointermove",i),document.addEventListener("pointerup",d),document.addEventListener("keydown",(e=>{})),document.addEventListener("keyup",(e=>{})),document.addEventListener("dblclick",a),{on(e,n){t.on(e,n)},removeListener(e,n){t.removeListener(e,n)},dispose(){document.removeEventListener("pointerdown",s),document.removeEventListener("pointerdown",d),document.removeEventListener("pointerdown",i),document.removeEventListener("dblclick",a)}}})(h),y=e=>{var t;if(!e.isPrimary)return;let n=f.resolveItem(e);n&&(v&&(null===(t=v.onDown)||void 0===t||t.call(v,e,n)),u.forEach((t=>{var o;return null===(o=t.onDown)||void 0===o?void 0:o.call(t,e,n)})))},E=e=>{var t;if(!e.isPrimary)return;let n=f.resolveItem(e);v&&(null===(t=v.onUp)||void 0===t||t.call(v,e,n)),u.forEach((t=>{var o;return null===(o=t.onUp)||void 0===o?void 0:o.call(t,e,n)}))},k=e=>{var t;let n=f.resolveItem(e);if(n){if(v)return void(null===(t=v.onContextMenu)||void 0===t||t.call(v,e,n));u.forEach((t=>{var o;return null===(o=t.onContextMenu)||void 0===o?void 0:o.call(t,e,n)}))}},L=e=>{var t;v?null===(t=v.onKeyUp)||void 0===t||t.call(v,e):u.forEach((t=>{var n;return null===(n=t.onKeyUp)||void 0===n?void 0:n.call(t,e)}))},C=e=>{var t;v?null===(t=v.onKeyDown)||void 0===t||t.call(v,e):u.forEach((t=>{var n;return null===(n=t.onKeyDown)||void 0===n?void 0:n.call(t,e)}))};return u.set("select",function(e,t){let n=e.state;return{name:"select",onUpdate:e=>{n=e.state},onKeyDown:t=>{var o;t.key===(null===(o=e.opts.select)||void 0===o?void 0:o.multiSelectKey)&&(n.multi=!0)},onKeyUp:t=>{var o;t.key===(null===(o=e.opts.select)||void 0===o?void 0:o.multiSelectKey)&&(n.multi=!1)},onDown:(o,l)=>{var r,s;if(l&&t.eventInGraph(o)){if("graph"===l.type){if(e.state.multi)return;o.button===(null===(r=e.opts.select)||void 0===r?void 0:r.button)&&e.dom.containerEl.contains(o.target)&&t.setSelected([])}if(("link"===l.type||"node"===l.type)&&(l=l,o.button===(null===(s=e.opts.select)||void 0===s?void 0:s.button)))switch(!0){case!n.multi&&!t.isSelected(l):case!n.multi&&t.isSelected(l)&&1===n.selected.size:t.setSelected([l]);break;case n.multi&&!t.isSelected(l):t.addToSelection([l]);break;case n.multi&&t.isSelected(l):t.removeFromSelection([l.key])}}}}}(h,f)),(null===(r=h.opts.panzoom)||void 0===r?void 0:r.enabled)&&u.set("panzoom",function(e,t,n){let o=e.opts.panzoom,l=e.state,r=e.dom,s=l.transform,i=(e.opts.width,e.opts.height,0),d=0,c=0,p=0;const u=e=>{if(((e,t)=>e.isPrimary&&"graph"===(null==t?void 0:t.type)&&("mouse"!==e.pointerType||e.button===o.controls.panButton))(e.source,t.resolveItem(e.source))){let e=r.containerEl.getBoundingClientRect(),t=r.rootEl.getBoundingClientRect();p=t.width-(Math.abs(s.x)+e.width),c=t.height-(Math.abs(s.y)+e.height),n.on("drag",g),n.on("dragend",v)}},g=e=>{console.log(e.deltaX,s.x,p),i=-a(-e.deltaX,s.x,p),d=-a(-e.deltaY,s.y,c),function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];r.rootEl.style.transition=e?"transform .3s":"",r.rootEl.style.transform=`translate(${s.x+i}px, ${s.y+d}px) scale(${s.scale})`}(!1)},v=e=>{s.x=s.x+i,s.y=s.y+d,n.removeListener("drag",g),n.removeListener("dragend",v)},h=e=>{};return n.on("dragstart",u),n.on("wheel",h),{name:"panzoom",onUpdate:e=>{o=e.opts.panzoom,l=e.state,r=e.dom,s=l.transform},dispose:()=>{n.removeListener("dragstart",u),n.removeListener("drag",g),n.removeListener("dragend",v),n.removeListener("wheel",h)}}}(h,f,m)),u.set("drag",function(e,t,o){let l=e.state,r=[],s=e.opts.drag.gridX||0,i=e.opts.drag.gridY||0;const d=function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=0!==s?s*Math.floor(t.scaledDeltaX/s):t.scaledDeltaX,l=0!==i?i*Math.floor(t.scaledDeltaY/i):t.scaledDeltaY;r.forEach((e=>{let t=0!==s?e.x%s:0,r=0!==i?e.y%i:0;if(n){let n=e.x+(o-t),s=e.y+(l-r);e.x=n,e.y=s,e.deltaX=0,e.deltaY=0}else e.deltaX=o-t,e.deltaY=l-r;w(e)})),x(e)},a=s=>{let i=t.resolveItem(s.source);((t,n)=>!l.multi&&0!==l.selected.size&&n&&"node"===n.type&&("mouse"!==t.pointerType||t.button===e.opts.select.button))(s.source,i)&&(r=Array.from(l.selected.values()).filter((e=>e.type===n.Node)),o.on("drag",c),o.on("dragend",p),d(s))},c=e=>{d(e)},p=e=>{d(e,!0),r=[],o.removeListener("drag",c),o.removeListener("dragend",p)};return o.on("dragstart",a),{name:"drag",onUpdate:e=>{l=e.state,s=e.opts.drag.gridX||0,i=e.opts.drag.gridY||0},dispose:()=>{o.removeListener("dragstart",a),o.removeListener("drag",c),o.removeListener("dragend",p)}}}(h,f,m)),u.set("linker",M(h,f)),u.set("context",function(e,t){const n=()=>t.closeContextMenu();return e.dom.containerEl.addEventListener("wheel",n),{name:"context",onContextMenu:(e,n)=>{if(n){let o,l;e.preventDefault(),e.stopPropagation(),[o,l]=t.pageToContainerPos(e.pageX,e.pageY),t.openContextMenu(o,l,n)}},onDown:()=>t.closeContextMenu(),dispose:()=>{e.dom.containerEl.removeEventListener("wheel",n)}}}(h,f)),u.set("shortcut",function(e,t){const n=(e,n)=>{t.eventInGraph(e)&&(e.preventDefault(),e.stopPropagation(),console.log("UNDO"),t.undo())},o=(e,n)=>{t.eventInGraph(e)&&(e.preventDefault(),e.stopPropagation(),console.log("REDO"),t.redo())},l=(e,n)=>{t.eventInGraph(e)&&(e.preventDefault(),e.stopPropagation(),console.log("DELETE"),t.removedSelectedItems())};return W("delete",{element:e.dom.containerEl},l),W("ctrl+z, command+z",{element:e.dom.containerEl},n),W("ctrl+shift+z, command+shift+z, ctrl+y, command+y",{element:e.dom.containerEl},o),{name:"shortcut",dispose:()=>{W.unbind("delete",l),W.unbind("ctrl+z, command+z",n),W.unbind("ctrl+shift+z, command+shift+z, ctrl+y, command+y",o)}}}(h,f)),(null===(s=h.opts.lasso)||void 0===s?void 0:s.enabled)&&u.set("lasso",function(e,t){let n=e.state,o=e.dom,l=!1,r=0,s=0;return{name:"lasso",onUpdate:e=>{n=e.state,o=e.dom},onDown:(t,n)=>{if(n&&!l&&"graph"===n.type){if(e.state.multi)return;t.button===e.opts.select.button&&(l=!0,r=t.pageX,s=t.pageY,o.lassoEl.style.display="block",e.lock("lasso"))}},onMove:e=>{if(l){let l,i,d=new Map,a=Math.max(e.pageX-r,r-e.pageX),c=Math.max(e.pageY-s,s-e.pageY);[l,i]=t.pageToContainerPos(Math.min(r,e.pageX),Math.min(s,e.pageY)),o.lassoEl.style.left=l+"px",o.lassoEl.style.top=i+"px",o.lassoEl.style.width=a+"px",o.lassoEl.style.height=c+"px";let p=o.lassoEl.getBoundingClientRect();n.nodes.forEach((e=>{var t,n;t=e.el.getBoundingClientRect(),(n=p).left>t.right||n.right<t.left||n.top>t.bottom||n.bottom<t.top||d.set(e.key,e)})),t.setPreselected(d)}},onUp:(i,d)=>{l&&(o.lassoEl.style.display="none",o.lassoEl.style.width="0px",o.lassoEl.style.height="0px",l=!1,r=0,s=0,t.setSelected(new Map(n.preselected)),t.setPreselected(new Map),e.unlock())}}}(h,f)),d.containerEl.addEventListener("contextmenu",k),document.addEventListener("pointerdown",y),document.addEventListener("pointerup",E),document.addEventListener("keydown",C),document.addEventListener("keyup",L),document.addEventListener("pointermove",(e=>{var t;v?null===(t=v.onMove)||void 0===t||t.call(v,e):u.forEach((t=>{var n;return null===(n=t.onMove)||void 0===n?void 0:n.call(t,e)}))})),Object.assign({on(e,t){p.on(e,t)},removeListener(e,t){p.removeListener(e,t)},dispose:()=>{d.containerEl.removeEventListener("contextmenu",k),document.removeEventListener("pointerdown",y),document.removeEventListener("pointerup",E),document.removeEventListener("keydown",C),document.removeEventListener("keyup",L),u.forEach((e=>{var t;return null===(t=e.dispose)||void 0===t?void 0:t.call(e)})),g.clear()},setOptions:e=>{i=Q(e),h.opts=i,u.forEach((e=>{var t;return null===(t=e.onUpdate)||void 0===t?void 0:t.call(e,h)}))},cancel:()=>{u.forEach((e=>{var t;return null===(t=e.onCancel)||void 0===t?void 0:t.call(e)}))}},f)}return e.p,r})()}));